jQuery(document).ready(function(b){var a={manager:function(c){if(c){b("#builder_blvd #manage_layouts .ajax-mitt").html(c)}else{b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_update_builder_table"},success:function(d){b("#builder_blvd #manage_layouts .ajax-mitt").html(d)}})}},delete_layout:function(e,f,c){var d=b("#manage_builder").find('input[name="_wpnonce"]').val();tbc_confirm(themeblvd.delete_layout,{confirm:true},function(g){if(g){b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_delete_layout",security:d,data:e},success:function(h){h=h.split("[(=>)]");b("#builder_blvd #manage_layout").prepend(h[1]);b("#builder_blvd #manage_layout .ajax-update").fadeIn(500,function(){setTimeout(function(){b("#builder_blvd #manage_layout .ajax-update").fadeOut(500,function(){b("#builder_blvd #manage_layout .ajax-update").remove()})},1500)});b("#builder_blvd .displaying-num").text(h[0]);if(f=="submit"){b("#manage_builder").find('input[name="posts[]"]').each(function(){if(b(this).is(":checked")){var j=b(this).val();if(b("#edit_layout-tab").hasClass(j+"-edit")){b("#edit_layout-tab").hide()}b(this).closest("tr").remove()}})}else{if(f=="click"){var i=e.replace("posts%5B%5D=","");if(b("#edit_layout-tab").hasClass(i+"-edit")){b("#edit_layout-tab").hide()}b("#row-"+i).remove()}}b("#manage_builder option").removeAttr("checked");if(c=="edit_page"){b("#builder_blvd .group").hide();b("#builder_blvd .group:first").fadeIn();b("#builder_blvd .nav-tab-wrapper a:first").addClass("nav-tab-active")}}})}})},add_layout:function(c){var e=c.val(),d=c.closest(".controls");b("#section-layout_sidebar .controls .warning").remove();if(e!="0"){b("#section-layout_sidebar select").hide();b("#section-layout_sidebar .controls").prepend('<p class="warning">The starting sample layout you\'ve chosen already has a sidebar layout.</p>');d.find(".sample-layouts div").hide();d.find("#sample-"+e).show()}else{b("#section-layout_sidebar select").fadeIn("fast");d.find(".sample-layouts div").hide()}},edit:function(c,d){var d=d.split("[(=>)]");b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").text(themeblvd.edit_layout+": "+c).addClass(d[0]+"-edit");b("#builder_blvd #edit_layout .ajax-mitt").html(d[1]);b(".sortable:not(:has(div))").addClass("empty");b(".sortable:has(div)").removeClass("empty");b(".sortable").sortable({handle:".widget-name",connectWith:".sortable"});b(".sortable").bind("sortreceive",function(e,f){b(".sortable:not(:has(div))").addClass("empty");b(".sortable:has(div)").removeClass("empty")});b("#builder_blvd .widget").themeblvd("widgets");b("#builder_blvd").themeblvd("options","setup");b("#builder_blvd .nav-tab-wrapper a").removeClass("nav-tab-active");b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").show().addClass("nav-tab-active");b("#builder_blvd .group").hide();b("#builder_blvd .group:last").fadeIn()}};b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").hide();if(typeof(localStorage)!="undefined"){if(localStorage.getItem("activetab")=="#edit_layout"){b("#builder_blvd .group").hide();b("#builder_blvd .group:first").fadeIn();b("#builder_blvd .nav-tab-wrapper a:first").addClass("nav-tab-active")}}b("#builder_blvd #manage_layouts .edit-tb_layout").live("click",function(){var c=b(this).closest("tr").find(".post-title .title-link").text(),d=b(this).attr("href"),d=d.replace("#","");b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_edit_layout",data:d},success:function(e){a.edit(c,e)}});return false});b("#builder_blvd .row-actions .trash a").live("click",function(){var c=b(this).attr("href"),e=c.replace("#",""),d="posts%5B%5D="+e;a.delete_layout(d,"click");return false});b("#manage_builder").live("submit",function(){var d=b(this).find('select[name="action"]').val(),c=b(this).serialize();if(d=="trash"){a.delete_layout(c,"submit")}return false});b("#layout_start").each(function(){a.add_layout(b(this))});b("#layout_start").change(function(){a.add_layout(b(this))});b("#optionsframework #add_new_builder").submit(function(){var e=b(this),g=e.serialize(),f=e.find(".ajax-loading"),c=e.find('input[name="options[layout_name]"]').val(),d=e.find('input[name="_wpnonce"]').val();if(!c){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});return false}b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_layout",security:d,data:g},beforeSend:function(){f.fadeIn("fast")},success:function(h){b("body").animate({scrollTop:0},100,function(){a.edit(c,h);tbc_alert.init(themeblvd.layout_created,"success");e.find('input[name="options[layout_name]"]').val("")});a.manager();f.hide()}});return false});b("#optionsframework #add_new_element").live("click",function(){var h=b(this),j,e,d,c,g=false,f=h.parent().find(".ajax-overlay"),i=h.parent().find(".ajax-loading");values=h.parent().find("select").val(),values=values.split("=>"),type=values[0],query=values[1];if(query=="primary"){b("#builder_blvd #builder .element-query").each(function(){if(b(this).val()=="primary"){g=true}});if(g){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"});return false}}b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:type},beforeSend:function(){f.fadeIn("fast");i.fadeIn("fast")},success:function(k){e=k.split('<div id="');d=e[1].split('" class="widget element-options"');c=d[0];b("#builder_blvd #edit_layout #primary .sortable").append(k);b("#builder_blvd #edit_layout #primary .sortable").removeClass("empty");b("#"+c).themeblvd("widgets");b("#"+c).themeblvd("options","setup");b("#"+c).fadeIn();i.fadeOut("fast");f.fadeOut("fast")}});return false});b("#optionsframework #edit_builder").live("submit",function(){var e=b(this),g=e.serialize(),f=e.find(".publishing-action .ajax-loading"),d=e.find('input[name="_wpnonce"]').val(),c;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_layout",security:d,data:g},beforeSend:function(){f.fadeIn("fast")},success:function(h){h=h.split("[(=>)]");b("#builder_blvd #edit_layout").prepend(h[1]);c=b("#builder_blvd #post_title").val();b("#builder_blvd #edit_layout-tab").text(themeblvd.edit_layout+": "+c);b("#builder_blvd .postbox-publish h3").text(themeblvd.publish+" "+c);b("#builder_blvd .postbox-layout-info #post_name").val(h[0]);b("body").animate({scrollTop:0},50,function(){b("#builder_blvd #edit_layout .ajax-update").fadeIn(500,function(){setTimeout(function(){b("#builder_blvd #edit_layout .ajax-update").fadeOut(500,function(){b("#builder_blvd #edit_layout .ajax-update").remove()})},1500)})});f.fadeOut("fast");a.manager()}});return false});b("#builder_blvd #edit_layout .delete_layout").live("click",function(){var c=b(this).attr("href"),e=c.replace("#",""),d="posts%5B%5D="+e;a.delete_layout(d,"click","edit_page");return false})});