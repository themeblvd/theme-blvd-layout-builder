jQuery(document).ready(function(b){var f=false;var i={};if("undefined"!==typeof themeblvdL10n){i=themeblvdL10n}else{if("undefined"!==typeof themeblvd){i=themeblvd}}var g={nag:function(){if(f){return false}window.onbeforeunload=function(){return true};f=true},edit:function(k){k.themeblvd("options","setup");k.themeblvd("options","media-uploader");k.themeblvd("options","editor");k.themeblvd("options","code-editor");k.themeblvd("options","column-widths");k.themeblvd("options","sortable");k.find(".sortable:not(:has(div))").addClass("empty");k.find(".sortable:has(div)").removeClass("empty");g.sort_setup();k.find(".element-columns, .element-jumbotron_slider").each(function(){g.columns(b(this).closest(".widget"))});if(!b.trim(k.find("#builder").html())){k.closest("#builder_blvd").find("#tb-clear-layout").hide()}else{k.closest("#builder_blvd").find("#tb-clear-layout").show()}k.find(".edit-section-display, .edit-element-display, .edit-block-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});k.find(".tb-block-options-link").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load})},sort_setup:function(){var m=b("#builder_blvd #tb-edit-layout .sortable"),k,n,l;m.each(function(){var o=b(this);if(o.is(":ui-sortable")){o.sortable("destroy")}});m.sortable({handle:".top-widget-name",connectWith:".sortable",remove:function(o,p){k=b(this).closest(".element-section").attr("id")},receive:function(o,p){h.find(".sortable:not(:has(div))").addClass("empty");h.find(".sortable:has(div)").removeClass("empty");n=b(this).closest(".element-section").attr("id");p.item.find("input, textarea, select, option").each(function(){var r=b(this),q=r.attr("name");if(q){r.attr("name",q.replace(k,n))}});p.item.find(".tb-sortable-option").each(function(){var q=b(this);l=q.data("name");l=l.replace(k,n);q.data("name",l)});l=p.item.data("field-name");l=l.replace(k,n);p.item.data("field-name",l);p.item.themeblvd("options","sortable")},stop:function(o,p){p.item.themeblvd("options","editor");g.nag()}})},sample_preview:function(k){var l=k.closest(".controls");l.find(".sample-layouts div").hide();l.find("#sample-"+k.val()).show()},hide_widget:function(l){var k=b("#"+l);if(k.hasClass("postbox-publish")){return}k.find(".tb-widget-content").hide()},show_widget:function(l){var k=b("#"+l);k.find(".tb-widget-content").show();if(k.hasClass("postbox-custom-styles")){k.themeblvd("options","code-editor")}},columns:function(l){var m,k,n;l.find(".column-blocks").sortable({handle:".block-widget-name h3",connectWith:"#"+l.closest(".widget").attr("id")+" .column-blocks",remove:function(o,p){n=b(this).html();if(!n.trim().length){b(this).addClass("mini-empty")}m=b(this).closest(".column").find(".col-num").val()},receive:function(p,q){var o=b(this),r;o.removeClass("mini-empty");k=o.closest(".column").find(".col-num").val();q.item.find("input, textarea, select, option").each(function(){var t=b(this),s=t.attr("name");if(s){t.attr("name",s.replace("col_"+m,"col_"+k))}});q.item.find(".tb-sortable-option").each(function(){var s=b(this);r=s.data("name");r=r.replace("col_"+m,"col_"+k);s.data("name",r)});r=q.item.data("field-name");r=r.replace("col_"+m,"col_"+k);q.item.data("field-name",r)},stop:function(o,p){g.nag()}});l.find(".edit-columns-config").off("click.tb-col-config");l.find(".edit-columns-config").on("click.tb-col-config",function(){var o=b(this);if(o.data("showing")){o.closest(".element-options").find(".columns-setup").stop().slideUp(200);o.stop().text(o.data("text-show")).data("showing",0)}else{o.closest(".element-options").find(".columns-setup").stop().slideDown(200);o.stop().text(o.data("text-hide")).data("showing",1)}return false});l.find(".column-blocks").each(function(){var o=b(this).html();if(!o.trim().length){b(this).addClass("mini-empty")}});l.find(".columns-config .add-block").off("click.tb-add-block");l.find(".columns-config .add-block").on("click.tb-add-block",function(){var t=b(this).closest(".column"),p=t.closest(".element-section").attr("id"),o=t.closest(".widget.element-options").attr("id"),u=t.find(".col-num").val(),q=t.find(".block-type").val(),r="";if(!q){tbc_confirm(i.no_element,{textOk:"Ok"});return false}var s={action:"themeblvd_add_block",data:"section_id="+p+"&element_id="+o+"&block_type="+q+"&col_num="+u};b.post(ajaxurl,s,function(v){v=v.split("[(=>)]");t.find(".column-blocks").append(v[1]).removeClass("mini-empty");r=t.find("#"+v[0]);b("#builder_blvd .add").removeClass("add");r.addClass("add");window.setTimeout(function(){r.removeClass("add")},500);r.themeblvd("options","setup");r.themeblvd("options","media-uploader");r.themeblvd("options","editor");r.themeblvd("options","code-editor");r.themeblvd("options","column-widths");r.themeblvd("options","sortable");r.find(".tb-block-options-link").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});l.find(".edit-block-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});g.nag()});return false});l.find(".column-width-input").off("themeblvd_update_columns");l.find(".column-width-input").on("themeblvd_update_columns",function(){var s=b(this),o=s.closest(".element-options").find(".columns-header"),q=s.val(),p=q.split("-"),p=p.length,r="";if(p==1){r=p+" "+i.column}else{r=p+" "+i.columns}o.find(".col-count").text(r);o.find(".col-config").text(q.replace(/-/g," - "));l.find(".columns-config").removeClass("columns-1 columns-2 columns-3 columns-4 columns-5").addClass("columns-"+p);g.nag()})},content_block_options_load:function(k){k.$modalWindow.themeblvd("options","bind");k.$modalWindow.themeblvd("options","setup");k.$modalWindow.themeblvd("options","media-uploader");k.$modalWindow.themeblvd("options","editor");k.$modalWindow.themeblvd("options","code-editor");k.$modalWindow.themeblvd("options","column-widths");k.$modalWindow.themeblvd("options","sortable");var m=k.$modalWindow.find(".element-display-options"),l=m.find("#section-bg_type select").val(),n=m.find("#section-apply_padding input").is(":checked");k.$modalWindow.on("change",".tb-query-check .of-input",function(){var p=b(this),o=false;if(p.val()=="paginated"){p.addClass("current");b(".tb-query-check .of-input").each(function(){if(!b(this).hasClass("current")&&b(this).val()=="paginated"){o=true}});if(o){tbc_confirm(i.primary_query,{textOk:"Ok"})}p.removeClass("current");return false}})},save_code_editors:function(){if("undefined"===typeof window.themeblvd){return}if("undefined"===typeof window.themeblvd.options){return}var l=window.themeblvd.options,k=null,m=null;if(l.codeEditors){for(k in l.codeEditors){l.codeEditors[k].codemirror.save()}}}};var j=b("#tb-editor-builder"),c=b("#page_template");b("#post").on("submit",function(){window.onbeforeunload=null});c.on("change",function(){if(b(this).val()=="template_builder.php"){j.addClass("template-active")}else{j.removeClass("template-active")}});j.find(".meta-box-nav").themeblvd("options","bind");j.find(".meta-box-nav").themeblvd("options","setup");j.find("#tb-template-sync").on("change",function(){var k=b(this);if(k.val()){j.find("#tb-edit-layout").hide();j.find("#tb-sync-layout").show();j.find("#tb-sync-layout .title").text(k.find('option[value="'+k.val()+'"]').text());j.find(".sync-overlay").fadeIn(100)}else{j.find("#tb-sync-layout").hide();j.find("#tb-edit-layout").show();j.find(".sync-overlay").fadeOut(100)}g.nag()});j.find("#tb-template-unsync").on("click",function(){j.find("#tb-sync-layout").hide();j.find("#tb-edit-layout").show();j.find(".sync-overlay").fadeOut(100);j.find("#tb-template-sync").val("");g.nag()});j.on("change","#tb-template-apply",function(){var l=b(this),m=l.val(),k=j.find(".ajax-overlay.full-overlay");tbc_confirm(i.template_apply,{confirm:true},function(n){if(n){k.fadeIn(100);var o={action:"themeblvd_apply_template",security:j.find('input[name="tb_nonce"]').val(),data:l.closest("form").serialize(),info:m};b.post(ajaxurl,o,function(p){j.find("#tb-edit-layout .ajax-mitt").html(p);g.edit(j.find("#tb-edit-layout"));o={action:"themeblvd_get_meta",security:j.find('input[name="tb_nonce"]').val(),key:"_tb_builder_styles",post_id:j.find('input[name="tb_post_id"]').val()};b.post(ajaxurl,o,function(q){var s=j.find("#tb-custom-styles-textarea");s.val(q);if(s.data("CodeMirrorInstance")){s.data("CodeMirrorInstance").setValue(q)}k.fadeOut(200)})})}});l.val("")});j.find("#tb-save-new-template").on("click",function(){var k={confirm:true,input:true,input_desc:i.template_desc,textOk:i.template_save,className:"text-center"};tbc_confirm("<h3>"+i.template_title+"</h3>",k,function(l){if(l){var n=j.find("#builder").find("input, option, select, textarea").serialize();var m={action:"themeblvd_add_template",security:j.find('input[name="tb_nonce"]').val(),data:"tb_template_name="+encodeURIComponent(l)+"&"+n+"&post_id="+j.find('input[name="tb_post_id"]').val()};j.find(".ajax-overlay.full-overlay").fadeIn(100);b.post(ajaxurl,m,function(p){p=p.split("[(=>)]");tbc_confirm(p[0]);j.find(".ajax-overlay.full-overlay").fadeOut(200);var q=j.find(".select-layout.apply");q.html(p[1]).find(".textbox").text(q.find('option[value=""]').text());var o=j.find(".select-layout.sync");o.html(p[2]).find(".textbox").text(o.find('option[value=""]').text())})}else{if(l===""){tbc_confirm(i.no_name)}}});return false});b("#tb-custom-styles-link").themeblvd("modal",null,{button:i.apply,form:true,padding:false,size:"medium",onSave:function(k){g.save_code_editors()}});j.find("#tb-clear-layout").on("click",function(){var m=b(this),k=j.find(".ajax-overlay.full-overlay"),l=j.find('input[name="tb_post_id"]').val();tbc_confirm(i.clear_layout,{confirm:true},function(n){if(n){k.fadeIn(100);var o={action:"themeblvd_clear_layout",security:j.find('input[name="tb_nonce"]').val(),data:l};b.post(ajaxurl,o,function(p){j.find("#tb-edit-layout .ajax-mitt").html(p);j.find("#tb-custom-styles-textarea").val("");g.edit(j.find("#tb-edit-layout"));k.fadeOut(200)})}});return false});b("#manage_layouts").find("form").on("submit.check",function(n){n.preventDefault();var l=b(this),m=l.find('select[name="action"]').val(),k=false;if(m!="trash"){return false}l.find('input[name="posts[]"]').each(function(){if(b(this).is(":checked")){k=true}});if(k){tbc_confirm(i.delete_layout,{confirm:true},function(o){if(o){l.off("submit.check").submit()}})}else{tbc_confirm(i.no_layouts)}});var d=b("#add_layout");d.themeblvd("init");d.themeblvd("options","setup");d.themeblvd("options","bind");d.find(".builder-samples #sample, .builder_samples #sample").each(function(){g.sample_preview(b(this))});d.find(".builder-samples #sample, .builder_samples #sample").on("change",function(){g.sample_preview(b(this))});d.find("form").submit(function(k){if(!b(this).find("#section-name .of-input").val()){tbc_confirm(i.no_name,{textOk:"Ok"});k.preventDefault();return false}});d.find(".builder_samples").hide();d.find(".trigger select").on("change",function(){if(b(this).val()=="sample"){d.find(".builder_samples").show()}else{d.find(".builder_samples").hide()}});var a=b("#builder_blvd.primary");a.find(".fade").delay(3000).animate({height:0,opacity:0},500,function(){b(this).remove()});a.on("click",".delete-layout",function(){var k=this.href;tbc_confirm(i.delete_layout,{confirm:true},function(l){if(l){location.href=k}});return false});a.each(function(){postboxes.add_postbox_toggles("nav-menus",{pbshow:g.show_widget,pbhide:g.hide_widget})});a.find(".ajax-save-template").on("click",function(){window.onbeforeunload=null;g.save_code_editors();if("undefined"!==typeof tinymce){tinymce.triggerSave()}var k=b(this).closest("form"),l=a.find("#publishing-action .ajax-loading"),m=k.find('input[name="tb_nonce"]').val(),n=k.serialize();b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_template",security:m,data:n},beforeSend:function(){l.fadeIn(200)},success:function(o){b("body").animate({scrollTop:0},50,function(){a.find(".nav-tab-wrapper").after('<div class="themeblvd-updated updated fade" style="display:none;"><p><strong>'+i.template_updated+"</strong></p></div>");a.find(".themeblvd-updated").fadeIn(500).delay(3000).fadeOut(500,function(){b(this).remove()});f=false;b("#tb-builder-notice").fadeOut(500,function(){b(this).remove()})});l.fadeOut(200)}});return false});a.on("change","#tb-template-apply",function(){var l=b(this),m=l.val(),k=a.find(".ajax-overlay.full-overlay");tbc_confirm(i.template_apply,{confirm:true},function(n){if(n){k.fadeIn(100);g.save_code_editors();var q="tb-custom-styles-textarea",p=null;if("undefined"!==typeof window.themeblvd){if("undefined"!==typeof window.themeblvd.options){if("undefined"!==typeof window.themeblvd.options.codeEditors[q]){p=window.themeblvd.options.codeEditors[q].codemirror}}}var o={action:"themeblvd_apply_template",security:a.find('input[name="tb_nonce"]').val(),data:l.closest("form").serialize(),info:m};b.post(ajaxurl,o,function(r){a.find("#tb-edit-layout .ajax-mitt").html(r);g.edit(a.find("#tb-edit-layout"));o={action:"themeblvd_get_meta",security:a.find('input[name="tb_nonce"]').val(),key:"_tb_builder_styles",post_id:a.find('input[name="template_id"]').val()};b.post(ajaxurl,o,function(s){if(p){p.setValue(s)}k.fadeOut(200)})})}});l.val("")});var e=b("#builder_blvd"),h=e.find("#tb-edit-layout");b("#wpbody-content").on("click","#tb-builder-notice .notice-dismiss",function(){b(this).closest("#tb-builder-notice").fadeOut(300,function(){b(this).remove()});return false});e.on("change",":input",function(){if(e.hasClass("manage")||e.hasClass("add")){return}if(b(this).hasClass("tb-select-element")||b(this).hasClass("block-type")){return}g.nag()});e.on("mousedown",".jquery-ui-slider-wrap",function(){g.nag()});e.on("themeblvd-color-change",".wp-picker-input-wrap > input",function(){g.nag()});b("body").on("themeblvd-modal-close themeblvd-modal-insert",".themeblvd-modal .button, .themeblvd-modal .button-link",function(){g.nag()});e.on("sortstop",".tb-sortable-option .item-container",function(){g.nag()});e.on("mouseup",".tb-sortable-option .add-item, .tb-sortable-option .delete-sortable-items",function(){g.nag()});h.themeblvd("init");h.themeblvd("options","bind");g.edit(h);h.on("click",".dynamic-label .label-text",function(){var k=b(this),l=k.closest(".dynamic-label").find(".label-input");k.css("opacity","0");l.show().focus();l.on("keydown.edit-label, focusout.edit-label",function(m){if((m.type=="keydown"&&m.keyCode==13)||m.type=="focusout"){if(!l.val()){l.val("...")}k.css("opacity","1").text(l.val());l.hide();l.off("keydown.edit-label, focusout.edit-label").trigger("blur");m.preventDefault();return false}})});h.on("click",".tb-add-new-section",function(){var n=b(this),k=n.parent().find(".ajax-overlay"),l=n.parent().find(".ajax-loading"),m;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_section",data:""},beforeSend:function(){k.show();l.fadeIn("fast")},success:function(p){var o=p.split('<div id="');trim_back=o[1].split('" class="element-section"');section_id=trim_back[0];h.find("#builder").append(p);h.closest("#builder_blvd").find("#tb-clear-layout").fadeIn("fast");h.find(".manage-elements .ajax-overlay").fadeOut("fast");h.find(".tb-no-sections").hide();l.fadeOut("fast");k.fadeOut("fast");m=h.find("#"+section_id);g.sort_setup();m.find(".sortable").addClass("empty");m.find(".edit-section-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});g.nag()}});return false});h.on("click",".delete-section",function(){var k=b(this);tbc_confirm(k.data("confirm"),{confirm:true},function(l){if(l){k.closest(".element-section").animate({height:0,opacity:0},500,function(){b(this).remove();if(!b.trim(h.find("#builder").html())){h.closest("#builder_blvd").find("#tb-clear-layout").fadeOut("fast");h.find(".manage-elements .ajax-overlay").fadeIn("fast");h.find(".tb-no-sections").slideDown()}g.nag()})}});return false});h.on("click",".shift-section-up, .shift-section-down",function(){var m=b(this),n="down",l=m.closest(".element-section"),k;if(m.hasClass("shift-section-up")){n="up"}if(n=="up"){k=l.prev(".element-section");if(l.is(".element-section:first-child")){tbc_confirm(i.shift_up_error,{textOk:"Ok"})}else{l.slideUp(200,function(){k.before(l);l.slideDown(200)})}}else{k=l.next(".element-section");if(l.is(".element-section:last-child")){tbc_confirm(i.shift_down_error,{textOk:"Ok"})}else{l.slideUp(200,function(){k.after(l);l.slideDown(200)})}}l.addClass("add");window.setTimeout(function(){l.removeClass("add")},500);g.nag();return false});h.on("click","#add_new_element",function(){var p=b(this),q,m,l,k,n=p.parent().find(".ajax-overlay.add-element"),o=p.parent().find(".ajax-loading");type=p.parent().find("select").val(),section=h.find(".element-section:first-child").attr("id"),$element="";if(!type){tbc_confirm(i.no_element,{textOk:"Ok"});return false}b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:"section_id="+section+"&element_type="+type},beforeSend:function(){n.show();o.fadeIn("fast")},success:function(r){m=r.split('<div id="');l=m[1].split('" class="widget element-options"');k=l[0];h.find(".element-section:first-child .elements").append(r).removeClass("empty");$element=b("#"+k);b("#builder_blvd .add").removeClass("add");$element.addClass("add");window.setTimeout(function(){$element.removeClass("add")},500);$element.themeblvd("options","setup");$element.themeblvd("options","media-uploader");$element.themeblvd("options","editor");$element.themeblvd("options","code-editor");$element.themeblvd("options","column-widths");$element.themeblvd("options","sortable");if($element.find(".widget-content").hasClass("element-columns")||$element.find(".widget-content").hasClass("element-jumbotron_slider")){g.columns($element)}$element.fadeIn();o.fadeOut("fast");n.fadeOut("fast");$element.find(".edit-element-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});g.nag()}});return false});h.on("click",".element-options-nav a",function(){var l=b(this),m=l.data("target"),k=l.closest(".widget");l.closest("ul").find("li").removeClass("active");l.closest("li").addClass("active");if(m=="display"){k.find(".element-display-options-wrap").removeClass("hide");k.find(".element-options-wrap").addClass("hide")}else{k.find(".element-options-wrap").removeClass("hide");k.find(".element-display-options-wrap").addClass("hide")}return false});h.on("click",".duplicate-element",function(){var m=b(this),l=m.closest(".widget"),n=l.find("input, option, select, textarea").serialize(),k;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_element",data:n},success:function(o){o=o.split("[(=>)]");l.after(o[1]);k=b("#"+o[0]);k.addClass("add");window.setTimeout(function(){k.removeClass("add")},500);k.themeblvd("options","setup");k.themeblvd("options","media-uploader");k.themeblvd("options","editor");k.themeblvd("options","code-editor");k.themeblvd("options","column-widths");k.themeblvd("options","sortable");if(k.find(".widget-content").hasClass("element-columns")||k.find(".widget-content").hasClass("element-jumbotron_slider")){g.columns(k)}k.find(".tb-block-options-link").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});k.find(".edit-element-display, .edit-block-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});g.nag()}});return false});h.on("click",".duplicate-block",function(){var k=b(this),m=k.closest(".block"),l;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_block",data:m.find("input, option, select, textarea").serialize()},success:function(n){n=n.split("[(=>)]");m.after(n[3]);l=b("#"+n[1]);l.addClass("add");window.setTimeout(function(){l.removeClass("add")},500);l.themeblvd("options","setup");l.themeblvd("options","media-uploader");l.themeblvd("options","editor");l.themeblvd("options","code-editor");l.themeblvd("options","sortable");l.find(".tb-block-options-link").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});l.find(".edit-block-display").themeblvd("modal",null,{button:i.apply,build:true,form:true,padding:false,size:"medium",onLoad:g.content_block_options_load});g.nag()}});return false});h.on("click",".delete-element",function(){var k=b(this).closest(".widget"),l=k.closest(".sortable");tbc_confirm(b(this).attr("title"),{confirm:true},function(m){if(m){k.addClass("delete fade-out");window.setTimeout(function(){k.slideUp(200,function(){b(this).remove();if(!l.html().trim().length){l.addClass("empty")}});b(".themeblvd-tooltip").remove()},750);g.nag()}});return false});h.on("click",".delete-block",function(){var k=b(this).closest(".block-widget"),l=k.closest(".column-blocks");tbc_confirm(b(this).attr("title"),{confirm:true},function(m){if(m){k.addClass("delete fade-out");window.setTimeout(function(){k.slideUp(200,function(){b(this).remove();if(!l.html().trim().length){l.addClass("mini-empty")}});b(".themeblvd-tooltip").remove()},750);g.nag()}});return false});h.on("change",".tb-query-check .of-input",function(){var l=b(this),k=false;if(l.val()=="paginated"){l.addClass("current");b(".tb-query-check .of-input").each(function(){if(!b(this).hasClass("current")&&b(this).val()=="paginated"){k=true}});if(k){tbc_confirm(i.primary_query,{textOk:"Ok"})}l.removeClass("current");return false}})});