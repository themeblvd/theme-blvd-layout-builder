jQuery(document).ready(function(b){var a={manager:function(c){if(c){b("#builder_blvd #manage_layouts .ajax-mitt").html(c)}else{b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_update_builder_table"},success:function(d){b("#builder_blvd #manage_layouts .ajax-mitt").html(d)}})}},delete_layout:function(e,f,c){var d=b("#manage_builder").find('input[name="_tb_manage_builder_nonce"]').val();tbc_confirm(themeblvd.delete_layout,{confirm:true},function(g){if(g){b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_delete_layout",security:d,data:e},success:function(h){h=h.split("[(=>)]");b("#builder_blvd #manage_layouts").prepend(h[1]);b("#builder_blvd #manage_layouts .ajax-update").fadeIn(500,function(){setTimeout(function(){b("#builder_blvd #manage_layouts .ajax-update").fadeOut(500,function(){b("#builder_blvd #manage_layouts .ajax-update").remove()})},1500)});b("#builder_blvd .displaying-num").text(h[0]);if(f=="submit"){b("#manage_builder").find('input[name="posts[]"]').each(function(){if(b(this).is(":checked")){var j=b(this).val();if(b("#edit_layout-tab").hasClass(j+"-edit")){b("#edit_layout-tab").hide()}b(this).closest("tr").remove()}})}else{if(f=="click"){var i=e.replace("posts%5B%5D=","");if(b("#edit_layout-tab").hasClass(i+"-edit")){b("#edit_layout-tab").hide()}b("#row-"+i).remove()}}b("#manage_builder option").removeAttr("checked");if(c=="edit_page"){b("#builder_blvd .group").hide();b("#builder_blvd .group:first").fadeIn();b("#builder_blvd .nav-tab-wrapper a:first").addClass("nav-tab-active")}}})}})},add_layout:function(c){var e=c.val(),d=c.closest(".subgroup");b("#section-layout_sidebar .controls .warning").remove();if(e=="layout"){d.find("#section-layout_sample").hide();d.find("#section-layout_existing").fadeIn("fast");b("#section-layout_sidebar .controls").prepend('<p class="warning">'+themeblvd.sidebar_layout_set+"</p>");b("#layout_sidebar").hide().closest(".tb-fancy-select").hide()}else{if(e=="sample"){d.find("#section-layout_existing").hide();d.find("#section-layout_sample").fadeIn("fast");b("#section-layout_sidebar .controls").prepend('<p class="warning">'+themeblvd.sidebar_layout_set+"</p>");b("#layout_sidebar").hide().closest(".tb-fancy-select").hide()}else{d.find("#section-layout_existing").hide();d.find("#section-layout_sample").hide();b("#layout_sidebar").show().closest(".tb-fancy-select").show()}}},sample_preview:function(c){var d=c.closest(".controls");d.find(".sample-layouts div").hide();d.find("#sample-"+c.val()).show()},edit:function(c,d){var d=d.split("[(=>)]");b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").text(themeblvd.edit_layout+": "+c).addClass(d[0]+"-edit");b("#builder_blvd #edit_layout .ajax-mitt").html(d[1]);b(".sortable:not(:has(div))").addClass("empty");b(".sortable:has(div)").removeClass("empty");b(".sortable").sortable({handle:".top-widget-name",connectWith:".sortable"});postboxes.add_postbox_toggles(pagenow,{pbshow:a.show_widget,pbhide:a.hide_widget});b(".sortable").bind("sortreceive",function(e,f){b(".sortable:not(:has(div))").addClass("empty");b(".sortable:has(div)").removeClass("empty")});b("#builder_blvd .widget").themeblvd("widgets");b("#builder_blvd").themeblvd("options","setup");b("#builder_blvd").themeblvd("options","media-uploader");b("#builder_blvd").themeblvd("options","editor");b("#builder_blvd").themeblvd("options","code-editor");b("#builder_blvd .element-columns, #builder_blvd .element-content").each(function(){a.columns(b(this).closest(".widget"))});if(b.isFunction(b.fn.ThemeBlvdModal)){b("#builder_blvd .tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"small",on_load:a.content_block_options_load})}b("#builder_blvd .nav-tab-wrapper a").removeClass("nav-tab-active");b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").css("display","inline-block").addClass("nav-tab-active");b("#builder_blvd .group").hide();b("#builder_blvd .group:last").fadeIn()},hide_widget:function(c){if(b("#"+c).hasClass("postbox-publish")){return}b("#"+c+" .tb-widget-content").hide()},show_widget:function(c){b("#"+c+" .tb-widget-content").show()},mini_edit:function(g,e,c,d){var f={action:"themeblvd_mini_edit_layout",security:e,data:g};b.post(ajaxurl,f,function(h){c.find(".ajax-mitt").html(h);setTimeout(function(){a.edit_now(c);c.find(".meta-box-nav .ajax-overlay").fadeOut("fast");c.find(".meta-box-nav .ajax-loading").fadeOut("fast");c.find(".ajax-mitt").css({height:"auto",overflow:"visible"});c.find("#edit_layout .ajax-overlay-layout-switch").fadeOut("fast").remove();if(d){a.confirm_new_layout()}},1000)})},change_layout:function(c,h,e){if(!h){h=c.val()}var g=c.closest("#builder_blvd"),d=g.find("input[name=tb_layout_id]").val(),f=g.find("input[name=_tb_save_builder_nonce]").val();if(d){tbc_confirm(themeblvd.save_switch_layout,{verify:true},function(i){g.find(".meta-box-nav .ajax-overlay").css("visibility","visible").fadeIn("fast");g.find(".meta-box-nav .ajax-loading").css("visibility","visible").fadeIn("fast");g.find("#edit_layout").prepend('<div class="ajax-overlay-layout-switch"></div>');g.find("#edit_layout .ajax-overlay-layout-switch").fadeIn("fast");g.find(".ajax-mitt").css({height:g.find(".ajax-mitt").outerHeight()+"px",overflow:"hidden"});if(i){var j={action:"themeblvd_save_layout",security:f,data:b("#post").serialize()};b.post(ajaxurl,j,function(k){a.mini_edit(h,f,g,e)})}else{a.mini_edit(h,f,g,e)}})}else{g.find(".meta-box-nav .ajax-overlay").css("visibility","visible").fadeIn("fast");g.find(".meta-box-nav .ajax-loading").css("visibility","visible").fadeIn("fast");g.find("#edit_layout").prepend('<div class="ajax-overlay-layout-switch"></div>');g.find("#edit_layout .ajax-overlay-layout-switch").fadeIn("fast");g.find(".ajax-mitt").css({height:g.find(".ajax-mitt").outerHeight()+"px",overflow:"hidden"});a.mini_edit(h,f,g,e)}},update_layout_toggle:function(c){var d={action:"themeblvd_layout_toggle",data:c};b.post(ajaxurl,d,function(e){b("#tb-layout-toggle").closest(".tb-fancy-select").replaceWith(e)})},confirm_new_layout:function(){var c=b("#tb_builder");c.find("#add_layout .ajax-loading").hide();c.find(".meta-box-nav li a").removeClass("nav-tab-active");c.find(".meta-box-nav li:first a").addClass("nav-tab-active");c.find(".group").hide();c.find("#edit_layout").show();b("html,body").animate({scrollTop:b("#tb_builder").offset().top-30},"fast");tbc_alert.init(themeblvd.layout_created,"success","#tb_builder");c.find("#layout_name").val("")},edit_now:function(c){c.find(".sortable:not(:has(div))").addClass("empty");c.find(".sortable:has(div)").removeClass("empty");c.find(".sortable").sortable({handle:".top-widget-name",connectWith:".sortable"});c.find(".sortable").bind("sortreceive",function(d,e){c.find(".sortable:not(:has(div))").addClass("empty");c.find(".sortable:has(div)").removeClass("empty")});c.find(".widget").themeblvd("widgets");c.themeblvd("options","setup");c.themeblvd("options","media-uploader");c.themeblvd("options","editor");c.themeblvd("options","code-editor");b("#builder_blvd .element-columns, #builder_blvd .element-content").each(function(){a.columns(b(this).closest(".widget"))});if(b.isFunction(b.fn.ThemeBlvdModal)){b("#builder_blvd .tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"small",on_load:a.content_block_options_load})}},columns:function(d){d.find(".column-num").change(function(){var g=b(this).val();d.find(".columns-config").removeClass("columns-1 columns-2 columns-3 columns-4 columns-5").addClass("columns-"+g)});var e,c,f;d.find(".column-blocks").sortable({handle:".content-block-handle h3",connectWith:"#"+d.closest(".widget").attr("id")+" .column-blocks",remove:function(g,h){f=b(this).html();if(!f.trim().length){b(this).addClass("mini-empty")}e=b(this).closest(".column").find(".col-num").val()},receive:function(h,i){var g=b(this),j;g.removeClass("mini-empty");c=g.closest(".column").find(".col-num").val();i.item.find("input, textarea, select, option").each(function(){var l=b(this),k=l.attr("name");if(k){l.attr("name",k.replace("col_"+e,"col_"+c))}});j=i.item.data("field-name");j=j.replace("col_"+e,"col_"+c);i.item.data("field-name",j);i.item.themeblvd("options","editor")}});d.find(".column-blocks").each(function(){var g=b(this).html();if(!g.trim().length){b(this).addClass("mini-empty")}});d.find(".columns-config .add-block").each(function(){b(this).click(function(){var i=b(this).closest(".column"),g=i.closest(".widget.element-options").attr("id"),h=i.find(".block-type").val(),l=i.find(".col-num").val(),k;var j={action:"themeblvd_add_block",data:g+"[(=>)]"+h+"[(=>)]"+l};b.post(ajaxurl,j,function(m){m=m.split("[(=>)]");i.find(".column-blocks").append(m[1]).removeClass("mini-empty");k=i.find("#"+m[0]);b("#builder_blvd .add").removeClass("add");k.addClass("add");window.setTimeout(function(){k.removeClass("add")},500);k.themeblvd("options","setup");k.themeblvd("options","media-uploader");k.themeblvd("options","editor");k.themeblvd("options","code-editor");if(b.isFunction(b.fn.ThemeBlvdModal)){k.find(".tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"small",on_load:a.content_block_options_load})}});return false})})},content_block_options_load:function(d){var c=this;c.$modal_window.themeblvd("options","bind");c.$modal_window.themeblvd("options","setup");c.$modal_window.themeblvd("options","media-uploader");c.$modal_window.themeblvd("options","editor");c.$modal_window.themeblvd("options","code-editor")}};b("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").hide();if(typeof(localStorage)!="undefined"){if(localStorage.getItem("activetab")=="#edit_layout"){b("#builder_blvd .group").hide();b("#builder_blvd .group:first").fadeIn();b("#builder_blvd .nav-tab-wrapper a:first").addClass("nav-tab-active")}}b(document).on("change","#adv-settings input",function(){var f=b(this),h=f.attr("name"),g="section-"+h,g=g.replace("-hide",""),c=b(this).closest("form").find(".security").val();if(f.is(":checked")){var e=new Array(h,"on");b("."+g).show()}else{var e=new Array(h,"off");b("."+g).hide()}var d={action:"themeblvd_save_screen_settings",security:c,data:e};b.post(ajaxurl,d,function(i){})});b("#tb_builder").each(function(){var c=b(this);c.find(".meta-box-nav li:first a").addClass("nav-tab-active");c.find(".group").hide();c.find("#edit_layout").show();c.find(".meta-box-nav li a").click(function(){var d=b(this),e=d.attr("href");c.find(".meta-box-nav li a").removeClass("nav-tab-active");d.addClass("nav-tab-active");c.find(".group").hide();c.find(e).show();return false})});b("#tb_builder").each(function(){a.edit_now(b(this))});b(document).on("change","#tb-layout-toggle",function(){a.change_layout(b(this))});b("#tb_builder #add_layout .button-primary").click(function(){var g=b(this),f=g.closest("#builder_blvd"),d=g.closest("#tb_builder"),c=f.find("#layout_name").val(),e=f.find("input[name=_tb_new_builder_nonce]").val(),i=b("#post").serialize();if(!c){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});return false}g.closest(".metabox-holder").find(".ajax-loading").fadeIn("fast");var h={action:"themeblvd_add_layout",security:e,data:i};b.post(ajaxurl,h,function(j){a.update_layout_toggle(j);a.change_layout(g,j,true)});return false});b(document).on("click","#builder_blvd #manage_layouts .edit-tb_layout",function(){var c=b(this).closest("tr").find(".post-title .title-link").text(),d=b(this).attr("href"),d=d.replace("#","");b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_edit_layout",data:d},success:function(e){a.edit(c,e)}});return false});b(document).on("click","#builder_blvd .row-actions .trash a",function(){var c=b(this).attr("href"),e=c.replace("#",""),d="posts%5B%5D="+e;a.delete_layout(d,"click");return false});b(document).on("submit","#manage_builder",function(){var d=b(this).find('select[name="action"]').val(),c=b(this).serialize();if(d=="trash"){a.delete_layout(c,"submit")}return false});b("#layout_start").each(function(){a.add_layout(b(this))});b("#layout_start").change(function(){a.add_layout(b(this))});b("#layout_sample").each(function(){a.sample_preview(b(this))});b("#layout_sample").change(function(){a.sample_preview(b(this))});b("#optionsframework #add_new_builder").submit(function(){var e=b(this),g=e.serialize(),f=e.find(".ajax-loading"),c=e.find('input[name="tb_new_layout[layout_name]"]').val(),d=e.find('input[name="_tb_new_builder_nonce"]').val();if(!c){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});return false}b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_layout",security:d,data:g},beforeSend:function(){f.fadeIn("fast")},success:function(h){b("body").animate({scrollTop:0},100,function(){a.edit(c,h);tbc_alert.init(themeblvd.layout_created,"success");e.find('input[name="options[layout_name]"]').val("")});a.manager();f.hide()}});return false});b(document).on("click","#optionsframework #add_new_element",function(){var h=b(this),j,e,d,c,g=false,f=h.parent().find(".ajax-overlay"),i=h.parent().find(".ajax-loading");values=h.parent().find("select").val(),values=values.split("=>"),type=values[0],query=values[1],element="";if(query=="primary"){b("#builder_blvd #builder .element-query").each(function(){if(b(this).val()=="primary"){g=true}});if(g){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"});return false}}b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:type},beforeSend:function(){f.show();i.fadeIn("fast")},success:function(k){e=k.split('<div id="');d=e[1].split('" class="widget element-options"');c=d[0];b("#builder_blvd #edit_layout #primary .sortable").append(k);b("#builder_blvd #edit_layout #primary .sortable").removeClass("empty");element=b("#"+c);b("#builder_blvd .add").removeClass("add");element.addClass("add");window.setTimeout(function(){element.removeClass("add")},500);element.themeblvd("widgets");element.themeblvd("options","setup");element.themeblvd("options","bind");element.themeblvd("options","media-uploader");element.themeblvd("options","editor");element.themeblvd("options","code-editor");if(element.find(".widget-content").hasClass("element-columns")){a.columns(element)}if(element.find(".widget-content").hasClass("element-content")){a.columns(element)}element.fadeIn();i.fadeOut("fast");f.fadeOut("fast")}});return false});b(document).on("click","#builder_blvd .duplicate-element",function(){var e=b(this),d=e.closest(".widget"),f=b("#builder_blvd").find('input[name="_tb_save_builder_nonce"]').val(),g=d.find("input, select, textarea").serialize(),c;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_element",security:f,data:g},success:function(h){h=h.split("[(=>)]");d.after(h[1]);c=b("#"+h[0]);c.addClass("add");window.setTimeout(function(){c.removeClass("add")},500);c.themeblvd("widgets");c.themeblvd("options","setup");c.themeblvd("options","bind");c.themeblvd("options","media-uploader");c.themeblvd("options","editor");c.themeblvd("options","code-editor");if(c.find(".widget-content").hasClass("element-columns")){a.columns(c)}if(c.find(".widget-content").hasClass("element-content")){a.columns(c)}if(b.isFunction(b.fn.ThemeBlvdModal)){c.find(".tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"small",on_load:a.content_block_options_load})}}});return false});b(document).on("submit","#optionsframework #edit_builder",function(){var e=b(this),g=e.serialize(),f=e.find("#publishing-action .ajax-loading"),d=e.find('input[name="_tb_save_builder_nonce"]').val(),c;b.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_layout",security:d,data:g},beforeSend:function(){f.fadeIn("fast")},success:function(h){h=h.split("[(=>)]");b("#builder_blvd #edit_layout").prepend(h[1]);c=b("#builder_blvd #post_title").val();b("#builder_blvd #edit_layout-tab").text(themeblvd.edit_layout+": "+c);b("#builder_blvd .postbox-publish h3").text(themeblvd.publish+" "+c);b("#builder_blvd .postbox-layout-info #post_name").val(h[0]);b("body").animate({scrollTop:0},50,function(){b("#builder_blvd #edit_layout .ajax-update").fadeIn(500,function(){setTimeout(function(){b("#builder_blvd #edit_layout .ajax-update").fadeOut(500,function(){b("#builder_blvd #edit_layout .ajax-update").remove()})},1500)})});f.fadeOut("fast");a.manager()}});return false});b(document).on("click","#optionsframework .delete-element",function(){var d=b(this).attr("href"),c=b(d),e=c.closest(".sortable");tbc_confirm(b(this).attr("title"),{confirm:true},function(f){if(f){c.addClass("delete fade-out");window.setTimeout(function(){c.remove();if(!e.html().trim().length){e.addClass("empty")}},750)}});return false});b(document).on("click","#builder_blvd #edit_layout .delete_layout",function(){var c=b(this).attr("href"),e=c.replace("#",""),d="posts%5B%5D="+e;a.delete_layout(d,"click","edit_page");return false})});