jQuery(document).ready(function(f){var g=false;var e={nag:function(){if(g){return false}var k=f("body").hasClass("toplevel_page_themeblvd_builder")?true:false,j=k?themeblvd.nag_save_template:themeblvd.nag_save,i='<div id="tb-builder-notice" class="notice notice-warning is-dismissible" style="display:none"> 						<p> '+j+'</p> 						<button type="button" class="notice-dismiss"><span class="screen-reader-text">'+themeblvd.dismiss+"</span></button> 						</div>";if(k){c.find(".nav-tab-wrapper").after(i).closest("#wpbody-content").find("#tb-builder-notice").fadeIn(500)}else{f("#lost-connection-notice").before(i).closest("#wpbody-content").find("#tb-builder-notice").fadeIn(500)}g=true},edit:function(i){i.themeblvd("options","setup");i.themeblvd("options","media-uploader");i.themeblvd("options","editor");i.themeblvd("options","code-editor");i.themeblvd("options","column-widths");i.themeblvd("options","sortable");i.find(".sortable:not(:has(div))").addClass("empty");i.find(".sortable:has(div)").removeClass("empty");e.sort_setup();i.find(".element-columns, .element-jumbotron_slider").each(function(){e.columns(f(this).closest(".widget"))});if(!f.trim(i.find("#builder").html())){i.closest("#builder_blvd").find("#tb-clear-layout").hide()}else{i.closest("#builder_blvd").find("#tb-clear-layout").show()}if(f.isFunction(f.fn.ThemeBlvdModal)){i.find(".edit-section-display, .edit-element-display, .edit-block-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}if(f.isFunction(f.fn.ThemeBlvdModal)){i.find(".tb-block-options-link").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}},sort_setup:function(){var k=f("#builder_blvd #tb-edit-layout .sortable"),i,l,j;k.each(function(){var m=f(this);if(m.is(":ui-sortable")){m.sortable("destroy")}});k.sortable({handle:".top-widget-name",connectWith:".sortable",remove:function(m,n){i=f(this).closest(".element-section").attr("id")},receive:function(m,n){h.find(".sortable:not(:has(div))").addClass("empty");h.find(".sortable:has(div)").removeClass("empty");l=f(this).closest(".element-section").attr("id");n.item.find("input, textarea, select, option").each(function(){var p=f(this),o=p.attr("name");if(o){p.attr("name",o.replace(i,l))}})},stop:function(m,n){e.nag()}})},sample_preview:function(i){var j=i.closest(".controls");j.find(".sample-layouts div").hide();j.find("#sample-"+i.val()).show()},hide_widget:function(j){var i=f("#"+j);if(i.hasClass("postbox-publish")){return}i.find(".tb-widget-content").hide()},show_widget:function(k){var j=f("#"+k);j.find(".tb-widget-content").show();if(j.hasClass("postbox-custom-styles")){var i=j.find("textarea").data("CodeMirrorInstance");if(i){i.refresh()}}},columns:function(j){var k,i,l;j.find(".column-blocks").sortable({handle:".block-widget-name h3",connectWith:"#"+j.closest(".widget").attr("id")+" .column-blocks",remove:function(m,n){l=f(this).html();if(!l.trim().length){f(this).addClass("mini-empty")}k=f(this).closest(".column").find(".col-num").val()},receive:function(n,o){var m=f(this),p;m.removeClass("mini-empty");i=m.closest(".column").find(".col-num").val();o.item.find("input, textarea, select, option").each(function(){var r=f(this),q=r.attr("name");if(q){r.attr("name",q.replace("col_"+k,"col_"+i))}});o.item.find(".tb-sortable-option").each(function(){var q=f(this);p=q.data("name");p=p.replace("col_"+k,"col_"+i);q.data("name",p)});p=o.item.data("field-name");p=p.replace("col_"+k,"col_"+i);o.item.data("field-name",p);o.item.themeblvd("options","editor");e.nag()},stop:function(){e.nag()}});j.find(".edit-columns-config").off("click.tb-col-config");j.find(".edit-columns-config").on("click.tb-col-config",function(){var m=f(this);if(m.data("showing")){m.closest(".element-options").find(".columns-setup").stop().slideUp(200);m.stop().text(m.data("text-show")).data("showing",0)}else{m.closest(".element-options").find(".columns-setup").stop().slideDown(200);m.stop().text(m.data("text-hide")).data("showing",1)}return false});j.find(".column-blocks").each(function(){var m=f(this).html();if(!m.trim().length){f(this).addClass("mini-empty")}});j.find(".columns-config .add-block").off("click.tb-add-block");j.find(".columns-config .add-block").on("click.tb-add-block",function(){var r=f(this).closest(".column"),n=r.closest(".element-section").attr("id"),m=r.closest(".widget.element-options").attr("id"),s=r.find(".col-num").val(),o=r.find(".block-type").val(),p="";if(!o){tbc_confirm(themeblvd.no_element,{textOk:"Ok"});return false}var q={action:"themeblvd_add_block",data:"section_id="+n+"&element_id="+m+"&block_type="+o+"&col_num="+s};f.post(ajaxurl,q,function(t){t=t.split("[(=>)]");r.find(".column-blocks").append(t[1]).removeClass("mini-empty");p=r.find("#"+t[0]);f("#builder_blvd .add").removeClass("add");p.addClass("add");window.setTimeout(function(){p.removeClass("add")},500);p.themeblvd("options","setup");p.themeblvd("options","media-uploader");p.themeblvd("options","editor");p.themeblvd("options","code-editor");p.themeblvd("options","column-widths");p.themeblvd("options","sortable");if(f.isFunction(f.fn.ThemeBlvdModal)){p.find(".tb-block-options-link").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}if(f.isFunction(f.fn.ThemeBlvdModal)){j.find(".edit-block-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}e.nag()});return false});j.find(".column-width-input").off("themeblvd_update_columns");j.find(".column-width-input").on("themeblvd_update_columns",function(){var q=f(this),m=q.closest(".element-options").find(".columns-header"),o=q.val(),n=o.split("-"),n=n.length,p="";if(n==1){p=n+" "+themeblvd.column}else{p=n+" "+themeblvd.columns}m.find(".col-count").text(p);m.find(".col-config").text(o.replace(/-/g," - "));j.find(".columns-config").removeClass("columns-1 columns-2 columns-3 columns-4 columns-5").addClass("columns-"+n);e.nag()})},content_block_options_load:function(l){var i=this;i.$modal_window.themeblvd("options","bind");i.$modal_window.themeblvd("options","setup");i.$modal_window.themeblvd("options","media-uploader");i.$modal_window.themeblvd("options","editor");i.$modal_window.themeblvd("options","code-editor");i.$modal_window.themeblvd("options","column-widths");i.$modal_window.themeblvd("options","sortable");var k=i.$modal_window.find(".element-display-options"),j=k.find("#section-bg_type select").val(),m=k.find("#section-apply_padding input").is(":checked");i.$modal_window.on("change",".tb-query-check .of-input",function(){var o=f(this),n=false;if(o.val()=="paginated"){o.addClass("current");f(".tb-query-check .of-input").each(function(){if(!f(this).hasClass("current")&&f(this).val()=="paginated"){n=true}});if(n){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"})}o.removeClass("current");return false}})}};var a=f("#tb-editor-builder"),b=f("#page_template");b.on("change",function(){if(f(this).val()=="template_builder.php"){a.addClass("template-active")}else{a.removeClass("template-active")}});a.find(".meta-box-nav").themeblvd("options","bind");a.find(".meta-box-nav").themeblvd("options","setup");a.find("#tb-template-sync").on("change",function(){var i=f(this);if(i.val()){a.find("#tb-edit-layout").hide();a.find("#tb-sync-layout").show();a.find("#tb-sync-layout .title").text(i.find('option[value="'+i.val()+'"]').text());a.find(".sync-overlay").fadeIn(100)}else{a.find("#tb-sync-layout").hide();a.find("#tb-edit-layout").show();a.find(".sync-overlay").fadeOut(100)}e.nag()});a.find("#tb-template-unsync").on("click",function(){a.find("#tb-sync-layout").hide();a.find("#tb-edit-layout").show();a.find(".sync-overlay").fadeOut(100);$select=a.find("#tb-template-sync");$select.val("").closest(".tb-fancy-select").find(".textbox").text($select.find('option[value=""]').text());e.nag()});a.on("change","#tb-template-apply",function(){var j=f(this),k=j.val(),i=a.find(".ajax-overlay.full-overlay");tbc_confirm(themeblvd.template_apply,{confirm:true},function(l){if(l){i.fadeIn(100);var m={action:"themeblvd_apply_template",security:a.find('input[name="tb_nonce"]').val(),data:j.closest("form").serialize(),info:k};f.post(ajaxurl,m,function(n){a.find("#tb-edit-layout .ajax-mitt").html(n);e.edit(a.find("#tb-edit-layout"));m={action:"themeblvd_get_meta",security:a.find('input[name="tb_nonce"]').val(),key:"_tb_builder_styles",post_id:a.find('input[name="tb_post_id"]').val()};f.post(ajaxurl,m,function(o){var p=a.find("#tb-custom-styles-textarea");p.val(o);if(p.data("CodeMirrorInstance")){p.data("CodeMirrorInstance").setValue(o)}i.fadeOut(200)})})}});j.val("").closest(".tb-fancy-select").find(".textbox").text(j.find('option[value=""]').text())});a.find("#tb-save-new-template").on("click",function(){var i={confirm:true,input:true,input_desc:themeblvd.template_desc,textOk:themeblvd.template_save,"class":"text-center"};tbc_confirm("<h3>"+themeblvd.template_title+"</h3>",i,function(j){if(j){var l=a.find("#builder").find("input, option, select, textarea").serialize();var k={action:"themeblvd_add_template",security:a.find('input[name="tb_nonce"]').val(),data:"tb_template_name="+encodeURIComponent(j)+"&"+l+"&post_id="+a.find('input[name="tb_post_id"]').val()};a.find(".ajax-overlay.full-overlay").fadeIn(100);f.post(ajaxurl,k,function(n){n=n.split("[(=>)]");tbc_confirm(n[0]);a.find(".ajax-overlay.full-overlay").fadeOut(200);var o=a.find(".select-layout.apply");o.html(n[1]).find(".textbox").text(o.find('option[value=""]').text());var m=a.find(".select-layout.sync");m.html(n[2]).find(".textbox").text(m.find('option[value=""]').text())})}else{if(j===""){tbc_confirm(themeblvd.no_name)}}});return false});a.find("#tb-clear-layout").on("click",function(){var k=f(this),i=a.find(".ajax-overlay.full-overlay"),j=a.find('input[name="tb_post_id"]').val();tbc_confirm(themeblvd.clear_layout,{confirm:true},function(l){if(l){i.fadeIn(100);var m={action:"themeblvd_clear_layout",security:a.find('input[name="tb_nonce"]').val(),data:j};f.post(ajaxurl,m,function(n){a.find("#tb-edit-layout .ajax-mitt").html(n);a.find("#tb-custom-styles-textarea").val("");e.edit(a.find("#tb-edit-layout"));i.fadeOut(200)})}});return false});f("#manage_layouts").find("form").on("submit.check",function(l){l.preventDefault();var j=f(this),k=j.find('select[name="action"]').val(),i=false;if(k!="trash"){return false}j.find('input[name="posts[]"]').each(function(){if(f(this).is(":checked")){i=true}});if(i){tbc_confirm(themeblvd.delete_layout,{confirm:true},function(m){if(m){j.off("submit.check").submit()}})}else{tbc_confirm(themeblvd.no_layouts)}});var d=f("#add_layout");d.themeblvd("init");d.themeblvd("options","setup");d.themeblvd("options","bind");d.find(".builder-samples #sample, .builder_samples #sample").each(function(){e.sample_preview(f(this))});d.find(".builder-samples #sample, .builder_samples #sample").on("change",function(){e.sample_preview(f(this))});d.find("form").submit(function(i){if(!f(this).find("#section-name .of-input").val()){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});i.preventDefault();return false}});d.find(".builder_samples").hide();d.find(".trigger select").on("change",function(){if(f(this).val()=="sample"){d.find(".builder_samples").show()}else{d.find(".builder_samples").hide()}});var c=f("#builder_blvd.primary");c.find(".fade").delay(3000).animate({height:0,opacity:0},500,function(){f(this).remove()});c.on("click",".delete-layout",function(){var i=this.href;tbc_confirm(themeblvd.delete_layout,{confirm:true},function(j){if(j){location.href=i}});return false});c.each(function(){postboxes.add_postbox_toggles("nav-menus",{pbshow:e.show_widget,pbhide:e.hide_widget})});c.find(".ajax-save-template").on("click",function(){var i=f(this).closest("form"),j=c.find("#publishing-action .ajax-loading"),k=i.find('input[name="tb_nonce"]').val(),l=i.serialize();f.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_template",security:k,data:l},beforeSend:function(){j.fadeIn(200)},success:function(m){f("body").animate({scrollTop:0},50,function(){c.find(".nav-tab-wrapper").after('<div class="themeblvd-updated updated fade" style="display:none;"><p><strong>'+themeblvd.template_updated+"</strong></p></div>");c.find(".themeblvd-updated").fadeIn(500).delay(3000).fadeOut(500,function(){f(this).remove()});g=false;f("#tb-builder-notice").fadeOut(500,function(){f(this).remove()})});j.fadeOut(200)}});return false});c.on("change","#tb-template-apply",function(){var j=f(this),k=j.val(),i=c.find(".ajax-overlay.full-overlay");tbc_confirm(themeblvd.template_apply,{confirm:true},function(l){if(l){i.fadeIn(100);var m={action:"themeblvd_apply_template",security:c.find('input[name="tb_nonce"]').val(),data:j.closest("form").serialize(),info:k};f.post(ajaxurl,m,function(n){c.find("#tb-edit-layout .ajax-mitt").html(n);e.edit(c.find("#tb-edit-layout"));m={action:"themeblvd_get_meta",security:c.find('input[name="tb_nonce"]').val(),key:"_tb_builder_styles",post_id:c.find('input[name="template_id"]').val()};f.post(ajaxurl,m,function(o){var p=c.find("#custom-styles textarea");p.val(o);if(p.data("CodeMirrorInstance")){p.data("CodeMirrorInstance").setValue(o)}i.fadeOut(200)})})}});j.val("").closest(".tb-fancy-select").find(".textbox").text(j.find('option[value=""]').text())});var h=f("#builder_blvd #tb-edit-layout");f("#wpbody-content").on("click","#tb-builder-notice .notice-dismiss",function(){f(this).closest("#tb-builder-notice").fadeOut(300,function(){f(this).remove()});return false});f("#builder_blvd").on("change",":input",function(){if(f(this).hasClass("tb-select-element")||f(this).hasClass("block-type")){return}e.nag()});f("#builder_blvd").on("mousedown",".jquery-ui-slider-wrap",function(){e.nag()});f("#builder_blvd").on("themeblvd-color-change",".wp-picker-input-wrap > input",function(){e.nag()});f("body").on("themeblvd-modal-close themeblvd-modal-insert",".themeblvd-modal .button, .themeblvd-modal .button-link",function(){e.nag()});f("#builder_blvd").on("sortstop",".tb-sortable-option .item-container",function(){e.nag()});f("#builder_blvd").on("mouseup",".tb-sortable-option .add-item, .tb-sortable-option .delete-sortable-items",function(){e.nag()});h.themeblvd("init");h.themeblvd("options","bind");e.edit(h);h.on("click",".dynamic-label .label-text",function(){var i=f(this),j=i.closest(".dynamic-label").find(".label-input");i.css("opacity","0");j.show().focus();j.on("keydown.edit-label, focusout.edit-label",function(k){if((k.type=="keydown"&&k.keyCode==13)||k.type=="focusout"){if(!j.val()){j.val("...")}i.css("opacity","1").text(j.val());j.hide();j.off("keydown.edit-label, focusout.edit-label").trigger("blur");k.preventDefault();return false}})});h.on("click",".tb-add-new-section",function(){var l=f(this),i=l.parent().find(".ajax-overlay"),j=l.parent().find(".ajax-loading"),k;f.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_section",data:""},beforeSend:function(){i.show();j.fadeIn("fast")},success:function(n){var m=n.split('<div id="');trim_back=m[1].split('" class="element-section"');section_id=trim_back[0];h.find("#builder").append(n);h.closest("#builder_blvd").find("#tb-clear-layout").fadeIn("fast");h.find(".manage-elements .ajax-overlay").fadeOut("fast");h.find(".tb-no-sections").hide();j.fadeOut("fast");i.fadeOut("fast");k=h.find("#"+section_id);e.sort_setup();k.find(".sortable").addClass("empty");if(f.isFunction(f.fn.ThemeBlvdModal)){k.find(".edit-section-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}e.nag()}});return false});h.on("click",".delete-section",function(){var i=f(this);tbc_confirm(i.data("confirm"),{confirm:true},function(j){if(j){i.closest(".element-section").animate({height:0,opacity:0},500,function(){f(this).remove();if(!f.trim(h.find("#builder").html())){h.closest("#builder_blvd").find("#tb-clear-layout").fadeOut("fast");h.find(".manage-elements .ajax-overlay").fadeIn("fast");h.find(".tb-no-sections").slideDown()}e.nag()})}});return false});h.on("click",".shift-section-up, .shift-section-down",function(){var k=f(this),l="down",j=k.closest(".element-section"),i;if(k.hasClass("shift-section-up")){l="up"}if(l=="up"){i=j.prev(".element-section");if(j.is(".element-section:first-child")){tbc_confirm(themeblvd.shift_up_error,{textOk:"Ok"})}else{j.slideUp(200,function(){i.before(j);j.slideDown(200)})}}else{i=j.next(".element-section");if(j.is(".element-section:last-child")){tbc_confirm(themeblvd.shift_down_error,{textOk:"Ok"})}else{j.slideUp(200,function(){i.after(j);j.slideDown(200)})}}j.addClass("add");window.setTimeout(function(){j.removeClass("add")},500);e.nag();return false});h.on("click","#add_new_element",function(){var n=f(this),o,k,j,i,l=n.parent().find(".ajax-overlay.add-element"),m=n.parent().find(".ajax-loading");type=n.parent().find("select").val(),section=h.find(".element-section:first-child").attr("id"),$element="";if(!type){tbc_confirm(themeblvd.no_element,{textOk:"Ok"});return false}f.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:"section_id="+section+"&element_type="+type},beforeSend:function(){l.show();m.fadeIn("fast")},success:function(p){k=p.split('<div id="');j=k[1].split('" class="widget element-options"');i=j[0];h.find(".element-section:first-child .elements").append(p).removeClass("empty");$element=f("#"+i);f("#builder_blvd .add").removeClass("add");$element.addClass("add");window.setTimeout(function(){$element.removeClass("add")},500);$element.themeblvd("options","setup");$element.themeblvd("options","media-uploader");$element.themeblvd("options","editor");$element.themeblvd("options","code-editor");$element.themeblvd("options","column-widths");$element.themeblvd("options","sortable");if($element.find(".widget-content").hasClass("element-columns")||$element.find(".widget-content").hasClass("element-jumbotron_slider")){e.columns($element)}$element.fadeIn();m.fadeOut("fast");l.fadeOut("fast");if(f.isFunction(f.fn.ThemeBlvdModal)){$element.find(".edit-element-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}e.nag()}});return false});h.on("click",".element-options-nav a",function(){var j=f(this),k=j.data("target"),i=j.closest(".widget");j.closest("ul").find("li").removeClass("active");j.closest("li").addClass("active");if(k=="display"){i.find(".element-display-options-wrap").removeClass("hide");i.find(".element-options-wrap").addClass("hide")}else{i.find(".element-options-wrap").removeClass("hide");i.find(".element-display-options-wrap").addClass("hide")}return false});h.on("click",".duplicate-element",function(){var k=f(this),j=k.closest(".widget"),l=j.find("input, option, select, textarea").serialize(),i;f.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_element",data:l},success:function(m){m=m.split("[(=>)]");j.after(m[1]);i=f("#"+m[0]);i.addClass("add");window.setTimeout(function(){i.removeClass("add")},500);i.themeblvd("options","setup");i.themeblvd("options","media-uploader");i.themeblvd("options","editor");i.themeblvd("options","code-editor");i.themeblvd("options","column-widths");i.themeblvd("options","sortable");if(i.find(".widget-content").hasClass("element-columns")||i.find(".widget-content").hasClass("element-jumbotron_slider")){e.columns(i)}if(f.isFunction(f.fn.ThemeBlvdModal)){i.find(".tb-block-options-link").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}if(f.isFunction(f.fn.ThemeBlvdModal)){i.find(".edit-element-display, .edit-block-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}e.nag()}});return false});h.on("click",".duplicate-block",function(){var i=f(this),k=i.closest(".block"),j;f.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_block",data:k.find("input, option, select, textarea").serialize()},success:function(l){l=l.split("[(=>)]");k.after(l[3]);j=f("#"+l[1]);j.addClass("add");window.setTimeout(function(){j.removeClass("add")},500);j.themeblvd("options","setup");j.themeblvd("options","media-uploader");j.themeblvd("options","editor");j.themeblvd("options","code-editor");j.themeblvd("options","sortable");j.find(".tb-block-options-link").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load});if(f.isFunction(f.fn.ThemeBlvdModal)){j.find(".edit-block-display").ThemeBlvdModal({button:themeblvd.apply,build:true,form:true,padding:false,size:"medium",on_load:e.content_block_options_load})}e.nag()}});return false});h.on("click",".delete-element",function(){var i=f(this).closest(".widget"),j=i.closest(".sortable");tbc_confirm(f(this).attr("title"),{confirm:true},function(k){if(k){i.addClass("delete fade-out");window.setTimeout(function(){i.slideUp(200,function(){f(this).remove();if(!j.html().trim().length){j.addClass("empty")}});f(".themeblvd-tooltip").remove()},750);e.nag()}});return false});h.on("click",".delete-block",function(){var i=f(this).closest(".block-widget"),j=i.closest(".column-blocks");tbc_confirm(f(this).attr("title"),{confirm:true},function(k){if(k){i.addClass("delete fade-out");window.setTimeout(function(){i.slideUp(200,function(){f(this).remove();if(!j.html().trim().length){j.addClass("mini-empty")}});f(".themeblvd-tooltip").remove()},750);e.nag()}});return false});h.on("change",".tb-query-check .of-input",function(){var j=f(this),i=false;if(j.val()=="paginated"){j.addClass("current");f(".tb-query-check .of-input").each(function(){if(!f(this).hasClass("current")&&f(this).val()=="paginated"){i=true}});if(i){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"})}j.removeClass("current");return false}})});