jQuery(document).ready(function(e){var d={edit:function(g){g.themeblvd("options","setup");g.themeblvd("options","media-uploader");g.themeblvd("options","editor");g.themeblvd("options","code-editor");g.themeblvd("options","column-widths");g.themeblvd("options","sortable");g.find(".sortable:not(:has(div))").addClass("empty");g.find(".sortable:has(div)").removeClass("empty");d.sort_setup();g.find(".element-columns").each(function(){d.columns(e(this).closest(".widget"))});if(e.isFunction(e.fn.ThemeBlvdModal)){g.find(".edit-section-display, .edit-element-display, .edit-block-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){g.find(".tb-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}},sort_setup:function(){var i=e("#builder_blvd #tb-edit-layout .sortable"),g,j,h;i.each(function(){var k=e(this);if(k.is(":ui-sortable")){k.sortable("destroy")}});i.sortable({handle:".top-widget-name",connectWith:".sortable"}).on("sortremove",function(k,l){g=e(this).closest(".element-section").attr("id")}).on("sortreceive",function(k,l){f.find(".sortable:not(:has(div))").addClass("empty");f.find(".sortable:has(div)").removeClass("empty");j=e(this).closest(".element-section").attr("id");l.item.find("input, textarea, select, option").each(function(){var n=e(this),m=n.attr("name");if(m){n.attr("name",m.replace(g,j))}});l.item.find(".tb-sortable-option").each(function(){var m=e(this),n=m.data("name");m.data("name",n.replace(g,j));console.log(n.replace(g,j))})})},sample_preview:function(g){var h=g.closest(".controls");h.find(".sample-layouts div").hide();h.find("#sample-"+select.val()).show()},hide_widget:function(g){$widget=e("#"+g);if($widget.hasClass("postbox-publish")){return}$widget.find(".tb-widget-content").hide()},show_widget:function(g){e("#"+g+" .tb-widget-content").show()},columns:function(h){var i,g,j;h.find(".column-blocks").sortable({handle:".block-widget-name h3",connectWith:"#"+h.closest(".widget").attr("id")+" .column-blocks",remove:function(k,l){j=e(this).html();if(!j.trim().length){e(this).addClass("mini-empty")}i=e(this).closest(".column").find(".col-num").val()},receive:function(l,m){var k=e(this),n;k.removeClass("mini-empty");g=k.closest(".column").find(".col-num").val();m.item.find("input, textarea, select, option").each(function(){var p=e(this),o=p.attr("name");if(o){p.attr("name",o.replace("col_"+i,"col_"+g))}});n=m.item.data("field-name");n=n.replace("col_"+i,"col_"+g);m.item.data("field-name",n);m.item.themeblvd("options","editor")}});h.find(".edit-columns-config").off("click.tb-col-config");h.find(".edit-columns-config").on("click.tb-col-config",function(){var k=e(this);if(k.data("showing")){k.closest(".element-options").find(".columns-setup").stop().slideUp(200);k.stop().text(k.data("text-show")).data("showing",0)}else{k.closest(".element-options").find(".columns-setup").stop().slideDown(200);k.stop().text(k.data("text-hide")).data("showing",1)}return false});h.find(".column-blocks").each(function(){var k=e(this).html();if(!k.trim().length){e(this).addClass("mini-empty")}});h.find(".columns-config .add-block").off("click.tb-add-block");h.find(".columns-config .add-block").on("click.tb-add-block",function(){var p=e(this).closest(".column"),l=p.closest(".element-section").attr("id"),k=p.closest(".widget.element-options").attr("id"),q=p.find(".col-num").val(),m=p.find(".block-type").val(),n="";var o={action:"themeblvd_add_block",data:"section_id="+l+"&element_id="+k+"&block_type="+m+"&col_num="+q};e.post(ajaxurl,o,function(r){r=r.split("[(=>)]");p.find(".column-blocks").append(r[1]).removeClass("mini-empty");n=p.find("#"+r[0]);e("#builder_blvd .add").removeClass("add");n.addClass("add");window.setTimeout(function(){n.removeClass("add")},500);n.themeblvd("options","setup");n.themeblvd("options","media-uploader");n.themeblvd("options","editor");n.themeblvd("options","code-editor");n.themeblvd("options","column-widths");n.themeblvd("options","sortable");if(e.isFunction(e.fn.ThemeBlvdModal)){n.find(".tb-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){h.find(".edit-block-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}});return false});h.find(".column-width-input").off("themeblvd_update_columns");h.find(".column-width-input").on("themeblvd_update_columns",function(){var o=e(this),k=o.closest(".element-options").find(".columns-header"),m=o.val(),l=m.split("-"),l=l.length,n="";if(l==1){n=l+" "+themeblvd.column}else{n=l+" "+themeblvd.columns}k.find(".col-count").text(n);k.find(".col-config").text(m.replace(/-/g," - "));h.find(".columns-config").removeClass("columns-1 columns-2 columns-3 columns-4 columns-5").addClass("columns-"+l)})},content_block_options_load:function(j){var g=this;g.$modal_window.themeblvd("options","bind");g.$modal_window.themeblvd("options","setup");g.$modal_window.themeblvd("options","media-uploader");g.$modal_window.themeblvd("options","editor");g.$modal_window.themeblvd("options","code-editor");g.$modal_window.themeblvd("options","column-widths");g.$modal_window.themeblvd("options","sortable");var i=g.$modal_window.find(".element-display-options"),h=i.find("#section-bg_type select").val(),k=i.find("#section-apply_padding input").is(":checked");g.$modal_window.on("change",".tb-query-check .of-input",function(){var m=e(this),l=false;if(m.val()=="paginated"){m.addClass("current");e(".tb-query-check .of-input").each(function(){if(!e(this).hasClass("current")&&e(this).val()=="paginated"){l=true}});if(l){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"})}m.removeClass("current");return false}})},show:function(g,h){if(!h){var h=g.find("#tb-content-layout")}var i=h.closest(".wp-editor-wrap");h.show();g.addClass("builder-active");h.addClass("tb-active");if(i.hasClass("html-active")){i.removeClass("html-active");i.addClass("tb-html-active")}else{if(i.hasClass("tmce-active")){i.removeClass("tmce-active");i.addClass("tb-tmce-active")}}e("#wp-content-media-buttons").addClass("tb-inactive").prepend('<div class="tb-overlay"></div>').find(".tb-overlay").animate({opacity:0.8},200);e("#wp-content-editor-container, #post-status-info").hide();g.find("#builder_blvd").show()},hide:function(g,h){var i=g.find(".wp-editor-wrap");if(!h){var h;if(i.hasClass("tb-tmce-active")){h=g.find("#content-tmce")}else{h=g.find("#content-html")}}if(i.hasClass("tb-html-active")||i.hasClass("tb-tmce-active")){g.removeClass("builder-active");i.find(".tb-switch-editor").removeClass("tb-active");e("#wp-content-media-buttons").removeClass("tb-inactive").find(".tb-overlay").remove();e("#wp-content-editor-container, #post-status-info").show();h.closest("#tb-editor-builder").find("#builder_blvd").hide()}if(h.attr("id")=="content-html"&&i.hasClass("tb-html-active")){i.removeClass("tb-html-active");i.addClass("html-active")}if(h.attr("id")=="content-tmce"&&i.hasClass("tb-tmce-active")){i.removeClass("tb-tmce-active");i.addClass("tmce-active")}}};var a=e("#tb-editor-builder"),b=e("#page_template");a.find(".wp-editor-tabs").prepend('<a href="#" id="tb-content-layout" class="tb-switch-editor switch-layout" style="display:none;">'+themeblvd.builder+"</a>");b.on("change",function(){if(e(this).val()=="template_builder.php"){a.addClass("template-active");a.find("#tb-content-layout").fadeIn(100)}else{a.removeClass("template-active");a.find("#tb-content-layout").fadeOut(100);d.hide(a)}});if(b.val()=="template_builder.php"){a.addClass("template-active");d.show(a)}a.find("#tb-content-layout").on("click",function(){d.show(a,e(this));return false});a.find("#content-html, #content-tmce").on("click",function(){d.hide(a,e(this))});a.find("#tb-template-sync").on("change",function(){var g=e(this);if(g.val()){a.find("#tb-edit-layout").hide();a.find("#tb-sync-layout").show();a.find("#tb-sync-layout .title").text(g.find('option[value="'+g.val()+'"]').text());a.find(".sync-overlay").fadeIn(100)}else{a.find("#tb-sync-layout").hide();a.find("#tb-edit-layout").show();a.find(".sync-overlay").fadeOut(100)}});a.find("#tb-template-unsync").on("click",function(){a.find("#tb-sync-layout").hide();a.find("#tb-edit-layout").show();a.find(".sync-overlay").fadeOut(100);$select=a.find("#tb-template-sync");$select.val("").closest(".tb-fancy-select").find(".textbox").text($select.find('option[value=""]').text())});a.on("change","#tb-template-apply",function(){var i=e(this),g=a.find(".ajax-overlay.full-overlay"),h=i.val();tbc_confirm(themeblvd.template_apply,{confirm:true},function(j){if(j){g.fadeIn(100);var k={action:"themeblvd_apply_template",security:a.find('input[name="tb_nonce"]').val(),data:h};e.post(ajaxurl,k,function(l){a.find("#tb-edit-layout .ajax-mitt").html(l);d.edit(a.find("#tb-edit-layout"));g.fadeOut(200)})}});i.val("").closest(".tb-fancy-select").find(".textbox").text(i.find('option[value=""]').text())});a.find("#save-new-template").on("click",function(){var g={confirm:true,input:true,input_desc:themeblvd.template_desc,textOk:themeblvd.template_save,"class":"text-center"};tbc_confirm("<h3>"+themeblvd.template_title+"</h3>",g,function(h){if(h){var j=a.find("#builder").find("input, option, select, textarea").serialize();var i={action:"themeblvd_add_template",security:a.find('input[name="tb_nonce"]').val(),data:"tb_template_name="+encodeURIComponent(h)+"&"+j};a.find(".ajax-overlay.full-overlay").fadeIn(100);e.post(ajaxurl,i,function(k){k=k.split("[(=>)]");tbc_confirm(k[0]);a.find(".ajax-overlay.full-overlay").fadeOut(200);var l=a.find(".select-layout.apply");l.html(k[1]).find(".textbox").text(l.find('option[value=""]').text())})}else{if(h===""){tbc_confirm(themeblvd.no_name)}}});return false});e("#manage_layouts").find("form").on("submit.check",function(j){j.preventDefault();var h=e(this),i=h.find('select[name="action"]').val(),g=false;if(i!="trash"){return false}h.find('input[name="posts[]"]').each(function(){if(e(this).is(":checked")){g=true}});if(g){tbc_confirm(themeblvd.delete_layout,{confirm:true},function(k){if(k){h.off("submit.check").submit()}})}else{tbc_confirm(themeblvd.no_layouts)}});$add_template=e("#add_layout");$add_template.themeblvd("init");$add_template.themeblvd("options","setup");$add_template.themeblvd("options","bind");$add_template.find("#layout_sample").each(function(){d.sample_preview(e(this))});$add_template.find("#layout_sample").change(function(){d.sample_preview(e(this))});$add_template.find("form").submit(function(g){if(!e(this).find("#section-name .of-input").val()){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});g.preventDefault();return false}});var c=e("#builder_blvd.primary");c.find(".fade").delay(3000).animate({height:0,opacity:0},500,function(){e(this).remove()});c.on("click",".delete-layout",function(){var g=this.href;tbc_confirm(themeblvd.delete_layout,{confirm:true},function(h){if(h){location.href=g}});return false});c.each(function(){postboxes.add_postbox_toggles(pagenow,{pbshow:d.show_widget,pbhide:d.hide_widget})});c.find(".ajax-save-template").on("click",function(){var g=e(this).closest("form"),h=c.find("#publishing-action .ajax-loading"),i=g.find('input[name="tb_nonce"]').val(),j=g.serialize();e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_template",security:i,data:j},beforeSend:function(){h.fadeIn(200)},success:function(k){e("body").animate({scrollTop:0},50,function(){c.find(".nav-tab-wrapper").after('<div class="themeblvd-updated updated fade" style="display:none;"><p><strong>'+themeblvd.template_updated+"</strong></p></div>");c.find(".themeblvd-updated").slideDown(100).delay(3000).animate({height:0,opacity:0},500,function(){e(this).remove()})});h.fadeOut(200)}});return false});var f=e("#builder_blvd #tb-edit-layout");f.themeblvd("init");f.themeblvd("options","bind");d.edit(f);f.on("click",".dynamic-label .label-text",function(){var g=e(this),h=g.closest(".dynamic-label").find(".label-input");g.css("opacity","0");h.show().focus();h.on("keydown.edit-label, focusout.edit-label",function(i){if((i.type=="keydown"&&i.keyCode==13)||i.type=="focusout"){if(!h.val()){h.val("...")}g.css("opacity","1").text(h.val());h.hide();h.off("keydown.edit-label, focusout.edit-label").trigger("blur");i.preventDefault();return false}})});f.on("click","#add_new_section",function(){var j=e(this),g=j.parent().find(".ajax-overlay"),h=j.parent().find(".ajax-loading"),i;e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_section",data:""},beforeSend:function(){g.show();h.fadeIn("fast")},success:function(l){var k=l.split('<div id="');trim_back=k[1].split('" class="element-section"');section_id=trim_back[0];f.find("#builder").append(l);h.fadeOut("fast");g.fadeOut("fast");i=f.find("#"+section_id);d.sort_setup();i.find(".sortable").addClass("empty");if(e.isFunction(e.fn.ThemeBlvdModal)){i.find(".edit-section-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}}});return false});f.on("click",".delete-section",function(){var g=e(this);tbc_confirm(g.data("confirm"),{confirm:true},function(h){if(h){g.closest(".element-section").animate({height:0,opacity:0},500,function(){e(this).remove()})}});return false});f.on("click",".shift-section-up, .shift-section-down",function(){var i=e(this),j="down",h=i.closest(".element-section"),g;if(i.hasClass("shift-section-up")){j="up"}if(j=="up"){g=h.prev(".element-section");if(h.is(".element-section:first-child")){tbc_confirm(themeblvd.shift_up_error,{textOk:"Ok"})}else{h.slideUp(200,function(){g.before(h);h.slideDown(200)})}}else{g=h.next(".element-section");if(h.is(".element-section:last-child")){tbc_confirm(themeblvd.shift_down_error,{textOk:"Ok"})}else{h.slideUp(200,function(){g.after(h);h.slideDown(200)})}}h.addClass("add");window.setTimeout(function(){h.removeClass("add")},500);return false});f.on("click","#add_new_element",function(){var l=e(this),m,i,h,g,j=l.parent().find(".ajax-overlay.add-element"),k=l.parent().find(".ajax-loading");type=l.parent().find("select").val(),section=f.find(".element-section:first-child").attr("id"),$element="";e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:"section_id="+section+"&element_type="+type},beforeSend:function(){j.show();k.fadeIn("fast")},success:function(n){i=n.split('<div id="');h=i[1].split('" class="widget element-options"');g=h[0];f.find(".element-section:first-child .elements").append(n).removeClass("empty");$element=e("#"+g);e("#builder_blvd .add").removeClass("add");$element.addClass("add");window.setTimeout(function(){$element.removeClass("add")},500);$element.themeblvd("options","setup");$element.themeblvd("options","media-uploader");$element.themeblvd("options","editor");$element.themeblvd("options","code-editor");$element.themeblvd("options","column-widths");$element.themeblvd("options","sortable");if($element.find(".widget-content").hasClass("element-columns")){d.columns($element)}$element.fadeIn();k.fadeOut("fast");j.fadeOut("fast");if(e.isFunction(e.fn.ThemeBlvdModal)){$element.find(".edit-element-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}}});return false});f.on("click",".duplicate-element",function(){var i=e(this),h=i.closest(".widget"),j=h.find("input, option, select, textarea").serialize(),g;e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_element",data:j},success:function(k){k=k.split("[(=>)]");h.after(k[1]);g=e("#"+k[0]);g.addClass("add");window.setTimeout(function(){g.removeClass("add")},500);g.themeblvd("options","setup");g.themeblvd("options","media-uploader");g.themeblvd("options","editor");g.themeblvd("options","code-editor");g.themeblvd("options","column-widths");g.themeblvd("options","sortable");if(g.find(".widget-content").hasClass("element-columns")){d.columns(g)}if(e.isFunction(e.fn.ThemeBlvdModal)){g.find(".tb-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){g.find(".edit-element-display, .edit-block-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}}});return false});f.on("click",".duplicate-block",function(){var g=e(this),i=g.closest(".block"),h;e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_block",data:i.find("input, option, select, textarea").serialize()},success:function(j){j=j.split("[(=>)]");i.after(j[3]);h=e("#"+j[1]);h.addClass("add");window.setTimeout(function(){h.removeClass("add")},500);h.themeblvd("options","setup");h.themeblvd("options","media-uploader");h.themeblvd("options","editor");h.themeblvd("options","code-editor");h.themeblvd("options","sortable");h.find(".tb-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load});if(e.isFunction(e.fn.ThemeBlvdModal)){h.find(".edit-block-display").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:d.content_block_options_load})}}});return false});f.on("click",".delete-element",function(){var g=e(this).closest(".widget"),h=g.closest(".sortable");tbc_confirm(e(this).attr("title"),{confirm:true},function(i){if(i){g.addClass("delete fade-out");window.setTimeout(function(){g.slideUp(200,function(){e(this).remove();if(!h.html().trim().length){h.addClass("empty")}});e(".themeblvd-tooltip").remove()},750)}});return false});f.on("click",".delete-block",function(){var g=e(this).closest(".block-widget"),h=g.closest(".column-blocks");tbc_confirm(e(this).attr("title"),{confirm:true},function(i){if(i){g.addClass("delete fade-out");window.setTimeout(function(){g.slideUp(200,function(){e(this).remove();if(!h.html().trim().length){h.addClass("mini-empty")}});e(".themeblvd-tooltip").remove()},750)}});return false});f.on("change",".tb-query-check .of-input",function(){var h=e(this),g=false;if(h.val()=="paginated"){h.addClass("current");e(".tb-query-check .of-input").each(function(){if(!e(this).hasClass("current")&&e(this).val()=="paginated"){g=true}});if(g){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"})}h.removeClass("current");return false}})});