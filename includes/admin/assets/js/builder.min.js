jQuery(document).ready(function(e){var b={manager:function(h){if(h){e("#builder_blvd #manage_layouts .ajax-mitt").html(h)}else{e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_update_builder_table"},success:function(i){e("#builder_blvd #manage_layouts .ajax-mitt").html(i)}})}},delete_layout:function(j,k,h){var i=e("#manage_builder").find('input[name="_tb_manage_builder_nonce"]').val();tbc_confirm(themeblvd.delete_layout,{confirm:true},function(l){if(l){e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_delete_layout",security:i,data:j},success:function(m){m=m.split("[(=>)]");e("#builder_blvd #manage_layouts").prepend(m[1]);e("#builder_blvd #manage_layouts .ajax-update").fadeIn(500,function(){setTimeout(function(){e("#builder_blvd #manage_layouts .ajax-update").fadeOut(500,function(){e("#builder_blvd #manage_layouts .ajax-update").remove()})},1500)});e("#builder_blvd .displaying-num").text(m[0]);if(k=="submit"){e("#manage_builder").find('input[name="posts[]"]').each(function(){if(e(this).is(":checked")){var o=e(this).val();if(e("#edit_layout-tab").hasClass(o+"-edit")){e("#edit_layout-tab").hide()}e(this).closest("tr").remove()}})}else{if(k=="click"){var n=j.replace("posts%5B%5D=","");if(e("#edit_layout-tab").hasClass(n+"-edit")){e("#edit_layout-tab").hide()}e("#row-"+n).remove()}}e("#manage_builder option").removeAttr("checked");if(h=="edit_page"){e("#builder_blvd .group").hide();e("#builder_blvd .group:first").fadeIn();e("#builder_blvd .nav-tab-wrapper a:first").addClass("nav-tab-active")}}})}})},add_layout:function(h){var j=h.val(),i=h.closest(".subgroup");e(".themeblvd-builder-legacy-1 #section-layout_sidebar .controls .warning").remove();if(j=="layout"){i.find("#section-layout_sample").hide();i.find("#section-layout_existing").fadeIn("fast");e(".themeblvd-builder-legacy-1 #section-layout_sidebar .controls").prepend('<p class="warning">'+themeblvd.sidebar_layout_set+"</p>");e(".themeblvd-builder-legacy-1 #layout_sidebar").hide().closest(".tb-fancy-select").hide()}else{if(j=="sample"){i.find("#section-layout_existing").hide();i.find("#section-layout_sample").fadeIn("fast")}else{i.find("#section-layout_existing").hide();i.find("#section-layout_sample").hide();e(".themeblvd-builder-legacy-1 #layout_sidebar").show().closest(".tb-fancy-select").show()}}},sample_preview:function(h){var i=h.closest(".controls");i.find(".sample-layouts div").hide();i.find("#sample-"+h.val()).show()},edit:function(h,i){var i=i.split("[(=>)]");e("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").text(themeblvd.edit_layout+": "+h).addClass(i[0]+"-edit");e("#builder_blvd #edit_layout .ajax-mitt").html(i[1]);e(".sortable:not(:has(div))").addClass("empty");e(".sortable:has(div)").removeClass("empty");e(".sortable").sortable({handle:".top-widget-name",connectWith:".sortable"});postboxes.add_postbox_toggles(pagenow,{pbshow:b.show_widget,pbhide:b.hide_widget});e(".sortable").bind("sortreceive",function(j,k){e(".sortable:not(:has(div))").addClass("empty");e(".sortable:has(div)").removeClass("empty")});e("#builder_blvd .widget").themeblvd("widgets");e("#builder_blvd").themeblvd("options","setup");e("#builder_blvd").themeblvd("options","media-uploader");e("#builder_blvd").themeblvd("options","editor");e("#builder_blvd").themeblvd("options","code-editor");e("#builder_blvd").themeblvd("options","column-widths");e("#builder_blvd").themeblvd("options","sortable");e("#builder_blvd .element-columns, #builder_blvd .element-content").each(function(){b.columns(e(this).closest(".widget"))});if(e.isFunction(e.fn.ThemeBlvdModal)){e("#builder_blvd .tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){e("#builder_blvd .tb-element-background-options").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}e("#builder_blvd").on("click",".element-label .label-text",function(){var j=e(this),k=j.closest(".element-label").find(".label-input");j.css("opacity","0");k.show().focus();k.on("keydown.edit-label, focusout.edit-label",function(l){if((l.type=="keydown"&&l.keyCode==13)||l.type=="focusout"){if(!k.val()){k.val("...")}j.css("opacity","1").text(k.val());k.hide();k.off("keydown.edit-label, focusout.edit-label");l.preventDefault();return false}})});e("#builder_blvd .nav-tab-wrapper a").removeClass("nav-tab-active");e("#builder_blvd .nav-tab-wrapper a.nav-edit-builder").css("display","inline-block").addClass("nav-tab-active");e("#builder_blvd .group").hide();e("#builder_blvd .group:last").fadeIn()},hide_widget:function(h){if(e("#"+h).hasClass("postbox-publish")){return}e("#"+h+" .tb-widget-content").hide()},show_widget:function(h){e("#"+h+" .tb-widget-content").show()},mini_edit:function(k,i,l,h){var j={action:"themeblvd_mini_edit_layout",security:i,data:k};e.post(ajaxurl,j,function(m){l.find(".ajax-mitt").html(m);setTimeout(function(){b.edit_now(l);l.find(".meta-box-nav .ajax-overlay").fadeOut("fast");l.find(".meta-box-nav .ajax-loading").fadeOut("fast");l.find(".ajax-mitt").css({height:"auto",overflow:"visible"});l.find("#edit_layout .ajax-overlay-layout-switch").fadeOut("fast").remove();if(h){b.confirm_new_layout()}},1000)})},change_layout:function(h,m,j){if(!m){m=h.val()}var l=h.closest("#builder_blvd"),i=l.find("input[name=tb_layout_id]").val(),k=l.find("input[name=_tb_save_builder_nonce]").val();if(i){tbc_confirm(themeblvd.save_switch_layout,{verify:true},function(n){l.find(".meta-box-nav .ajax-overlay").css("visibility","visible").fadeIn("fast");l.find(".meta-box-nav .ajax-loading").css("visibility","visible").fadeIn("fast");l.find("#edit_layout").prepend('<div class="ajax-overlay-layout-switch"></div>');l.find("#edit_layout .ajax-overlay-layout-switch").fadeIn("fast");l.find(".ajax-mitt").css({height:l.find(".ajax-mitt").outerHeight()+"px",overflow:"hidden"});if(n){var o={action:"themeblvd_save_layout",security:k,data:e("#post").serialize()};e.post(ajaxurl,o,function(p){b.mini_edit(m,k,l,j)})}else{b.mini_edit(m,k,l,j)}})}else{l.find("#add_layout").fadeOut("fast");l.find(".meta-box-nav .ajax-overlay").css("visibility","visible").fadeIn("fast");l.find(".meta-box-nav .ajax-loading").css("visibility","visible").fadeIn("fast");l.find("#edit_layout").prepend('<div class="ajax-overlay-layout-switch"></div>');l.find("#edit_layout .ajax-overlay-layout-switch").fadeIn("fast");l.find(".ajax-mitt").css({height:l.find(".ajax-mitt").outerHeight()+"px",overflow:"hidden"});b.mini_edit(m,k,l,j)}},update_layout_toggle:function(h){var i={action:"themeblvd_layout_toggle",data:h};e.post(ajaxurl,i,function(j){e("#tb-layout-toggle").closest(".tb-fancy-select").replaceWith(j)})},confirm_new_layout:function(){var h=e("#tb-editor-builder");h.find("#add_layout .ajax-loading").hide();tbc_alert.init(themeblvd.layout_created,"success","#builder_blvd");h.find(".meta-box-nav li a").removeClass("nav-tab-active");h.find(".meta-box-nav li:first a").addClass("nav-tab-active");h.find("#add_layout").hide();h.find("#edit_layout").show();h.find("#layout_name").val("")},edit_now:function(h){h.find(".sortable:not(:has(div))").addClass("empty");h.find(".sortable:has(div)").removeClass("empty");h.find(".sortable").sortable({handle:".top-widget-name",connectWith:".sortable"});h.find(".sortable").bind("sortreceive",function(i,j){h.find(".sortable:not(:has(div))").addClass("empty");h.find(".sortable:has(div)").removeClass("empty")});h.find(".widget").themeblvd("widgets");h.themeblvd("options","setup");h.themeblvd("options","media-uploader");h.themeblvd("options","editor");h.themeblvd("options","code-editor");h.themeblvd("options","column-widths");h.themeblvd("options","sortable");e("#builder_blvd .element-columns, #builder_blvd .element-content").each(function(){b.columns(e(this).closest(".widget"))});if(e.isFunction(e.fn.ThemeBlvdModal)){e("#builder_blvd .tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){e("#builder_blvd .tb-element-background-options").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}h.on("click",".element-label .label-text",function(){var i=e(this),j=i.closest(".element-label").find(".label-input");i.css("opacity","0");j.show().focus();j.on("keydown.edit-label, focusout.edit-label",function(k){if((k.type=="keydown"&&k.keyCode==13)||k.type=="focusout"){if(!j.val()){j.val("...")}i.css("opacity","1").text(j.val());j.hide();j.off("keydown.edit-label, focusout.edit-label");k.preventDefault();return false}})})},columns:function(i){var j,h,k;i.find(".column-blocks").sortable({handle:".content-block-handle h3",connectWith:"#"+i.closest(".widget").attr("id")+" .column-blocks",remove:function(l,m){k=e(this).html();if(!k.trim().length){e(this).addClass("mini-empty")}j=e(this).closest(".column").find(".col-num").val()},receive:function(m,n){var l=e(this),o;l.removeClass("mini-empty");h=l.closest(".column").find(".col-num").val();n.item.find("input, textarea, select, option").each(function(){var q=e(this),p=q.attr("name");if(p){q.attr("name",p.replace("col_"+j,"col_"+h))}});o=n.item.data("field-name");o=o.replace("col_"+j,"col_"+h);n.item.data("field-name",o);n.item.themeblvd("options","editor")}});i.find(".column-blocks").each(function(){var l=e(this).html();if(!l.trim().length){e(this).addClass("mini-empty")}});i.find(".columns-config .add-block").each(function(){e(this).click(function(){var o=e(this).closest(".column"),m=o.closest(".widget.element-options").attr("id"),l=o.find(".col-num").val(),q=false,t=o.find(".block-type").val(),t=t.split("=>"),s=t[0],r=t[1],n="";if(r=="primary"){e("#builder_blvd #builder .element-query").each(function(){if(e(this).val()=="primary"){q=true}});if(q){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"});return false}}var p={action:"themeblvd_add_block",data:m+"[(=>)]"+s+"[(=>)]"+l};e.post(ajaxurl,p,function(u){u=u.split("[(=>)]");o.find(".column-blocks").append(u[1]).removeClass("mini-empty");n=o.find("#"+u[0]);e("#builder_blvd .add").removeClass("add");n.addClass("add");window.setTimeout(function(){n.removeClass("add")},500);n.themeblvd("options","setup");n.themeblvd("options","media-uploader");n.themeblvd("options","editor");n.themeblvd("options","code-editor");n.themeblvd("options","column-widths");n.themeblvd("options","sortable");if(e.isFunction(e.fn.ThemeBlvdModal)){n.find(".tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}});return false})});i.find(".select-col-num").on("change",function(){i.find(".columns-config").removeClass("columns-1 columns-2 columns-3 columns-4 columns-5").addClass("columns-"+e(this).val())})},content_block_options_load:function(i){var h=this;h.$modal_window.themeblvd("options","bind");h.$modal_window.themeblvd("options","setup");h.$modal_window.themeblvd("options","media-uploader");h.$modal_window.themeblvd("options","editor");h.$modal_window.themeblvd("options","code-editor");h.$modal_window.themeblvd("options","column-widths");h.$modal_window.themeblvd("options","sortable")}};e("#builder_blvd.primary .nav-tab-wrapper a.nav-edit-builder").hide();if(typeof(localStorage)!="undefined"){if(localStorage.getItem("activetab")=="#edit_layout"){e("#builder_blvd.primary .group").hide();e("#builder_blvd.primary .group:first").fadeIn();e("#builder_blvd.primary .nav-tab-wrapper a:first").addClass("nav-tab-active")}}e(document).on("change","#adv-settings input",function(){var k=e(this),m=k.attr("name"),l="section-"+m,l=l.replace("-hide",""),h=e(this).closest("form").find(".security").val();if(k.is(":checked")){var j=new Array(m,"on");e("."+l).show()}else{var j=new Array(m,"off");e("."+l).hide()}var i={action:"themeblvd_save_screen_settings",security:h,data:j};e.post(ajaxurl,i,function(n){})});var a=e("#tb-editor-builder"),g=a.find("#builder_blvd");if(e("#page_template").val()=="template_builder.php"){var d=a.find("#content-layout"),f=d.closest(".wp-editor-wrap");a.addClass("builder-active");d.addClass("tb-active");if(f.hasClass("html-active")){f.removeClass("html-active");f.addClass("tb-html-active")}else{if(f.hasClass("tmce-active")){f.removeClass("tmce-active");f.addClass("tb-tmce-active")}}e("#wp-content-media-buttons").addClass("tb-inactive").prepend('<div class="tb-overlay"></div>').find(".tb-overlay").animate({opacity:0.8},200);e("#wp-content-editor-container, #post-status-info").hide();a.find("#builder_blvd").show()}a.find("#content-layout").on("click",function(){var h=e(this),i=h.closest(".wp-editor-wrap");if(h.hasClass("tb-active")){return false}a.addClass("builder-active");h.addClass("tb-active");if(i.hasClass("html-active")){i.removeClass("html-active");i.addClass("tb-html-active")}else{if(i.hasClass("tmce-active")){i.removeClass("tmce-active");i.addClass("tb-tmce-active")}}e("#wp-content-media-buttons").addClass("tb-inactive").prepend('<div class="tb-overlay"></div>').find(".tb-overlay").animate({opacity:0.8},200);e("#wp-content-editor-container, #post-status-info").hide();a.find("#builder_blvd").show();return false});a.find("#content-html, #content-tmce").on("click",function(){var h=e(this),i=e(this).closest(".wp-editor-wrap");if(i.hasClass("tb-html-active")||i.hasClass("tb-tmce-active")){a.removeClass("builder-active");i.find(".tb-switch-editor").removeClass("tb-active");e("#wp-content-media-buttons").removeClass("tb-inactive").find(".tb-overlay").remove();e("#wp-content-editor-container, #post-status-info").show();h.closest("#tb-editor-builder").find("#builder_blvd").hide()}if(h.attr("id")=="content-html"&&i.hasClass("tb-html-active")){i.removeClass("tb-html-active");i.addClass("html-active")}if(h.attr("id")=="content-tmce"&&i.hasClass("tb-tmce-active")){i.removeClass("tb-tmce-active");i.addClass("tmce-active")}return false});g.find("#edit_layout").show();g.find(".add-new-layout").on("click",function(){var h=e(this);a.addClass("new-layout-active");h.hide().closest(".meta-box-nav").find(".cancel-new-layout, .save-new-layout").show();g.find("#edit_layout").hide();g.find("#add_layout").show();return false});g.find(".cancel-new-layout").on("click",function(){var h=e(this);a.removeClass("new-layout-active");h.hide();h.closest(".meta-box-nav").find(".save-new-layout").hide();h.closest(".meta-box-nav").find(".add-new-layout").show();g.find("#add_layout").hide();g.find("#edit_layout").show();return false});b.edit_now(g);g.on("change","#tb-layout-toggle",function(){b.change_layout(e(this))});g.find(".save-new-layout").on("click",function(){var k=e(this),l=k.closest("#builder_blvd"),h=l.find("#layout_name").val(),i=l.find("input[name=_tb_new_builder_nonce]").val(),m=e("#post").serialize();if(!h){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});return false}k.hide();k.closest(".meta-box-nav").find(".cancel-new-layout").hide();k.closest(".meta-box-nav").find(".add-new-layout").show();k.closest(".metabox-holder").find(".ajax-loading").fadeIn("fast");var j={action:"themeblvd_add_layout",security:i,data:m};e.post(ajaxurl,j,function(n){b.update_layout_toggle(n);b.change_layout(k,n,true);a.removeClass("new-layout-active")});return false});var c=e("#manage_layouts");c.on("click",".edit-tb_layout",function(){var h=e(this).closest("tr").find(".post-title .title-link").text(),i=e(this).attr("href"),i=i.replace("#","");e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_edit_layout",data:i},success:function(j){b.edit(h,j)}});return false});c.on("click",".row-actions .trash a",function(){var h=e(this).attr("href"),j=h.replace("#",""),i="posts%5B%5D="+j;b.delete_layout(i,"click");return false});c.on("submit","#manage_builder",function(){var i=e(this).find('select[name="action"]').val(),h=e(this).serialize();if(i=="trash"){b.delete_layout(h,"submit")}return false});$add_layout=e("#add_layout");$add_layout.find("#layout_start").each(function(){b.add_layout(e(this))});$add_layout.find("#layout_start").change(function(){b.add_layout(e(this))});$add_layout.find("#layout_sample").each(function(){b.sample_preview(e(this))});$add_layout.find("#layout_sample").change(function(){b.sample_preview(e(this))});$add_layout.find("#add_new_builder").submit(function(){var j=e(this),l=j.serialize(),k=j.find(".ajax-loading"),h=j.find('input[name="tb_new_layout[layout_name]"]').val(),i=j.find('input[name="_tb_new_builder_nonce"]').val();if(!h){tbc_confirm(themeblvd.no_name,{textOk:"Ok"});return false}e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_layout",security:i,data:l},beforeSend:function(){k.fadeIn("fast")},success:function(m){e("body").animate({scrollTop:0},100,function(){b.edit(h,m);tbc_alert.init(themeblvd.layout_created,"success");j.find('input[name="options[layout_name]"]').val("")});b.manager();k.hide()}});return false});var g=e("#builder_blvd");g.on("click","#add_new_element",function(){var n=e(this),o,j,i,h,l=false,k=n.parent().find(".ajax-overlay"),m=n.parent().find(".ajax-loading");values=n.parent().find("select").val(),values=values.split("=>"),type=values[0],query=values[1],$element="";if(query=="primary"){e("#builder_blvd #builder .element-query").each(function(){if(e(this).val()=="primary"){l=true}});if(l){tbc_confirm(themeblvd.primary_query,{textOk:"Ok"});return false}}e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_add_element",data:type},beforeSend:function(){k.show();m.fadeIn("fast")},success:function(p){j=p.split('<div id="');i=j[1].split('" class="widget element-options"');h=i[0];e("#builder_blvd #edit_layout .primary.sortable").append(p);e("#builder_blvd #edit_layout .primary.sortable").removeClass("empty");$element=e("#"+h);e("#builder_blvd .add").removeClass("add");$element.addClass("add");window.setTimeout(function(){$element.removeClass("add")},500);$element.themeblvd("widgets");$element.themeblvd("options","setup");$element.themeblvd("options","bind");$element.themeblvd("options","media-uploader");$element.themeblvd("options","editor");$element.themeblvd("options","code-editor");$element.themeblvd("options","column-widths");$element.themeblvd("options","sortable");if($element.find(".widget-content").hasClass("element-columns")){b.columns($element)}if($element.find(".widget-content").hasClass("element-content")){b.columns($element)}$element.fadeIn();m.fadeOut("fast");k.fadeOut("fast");if(e.isFunction(e.fn.ThemeBlvdModal)){$element.find(".tb-element-background-options").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}}});return false});g.on("click",".duplicate-element",function(){var j=e(this),i=j.closest(".widget"),k=g.find('input[name="_tb_save_builder_nonce"]').val(),l=i.find("input, select, textarea").serialize(),h;e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_dup_element",security:k,data:l},success:function(m){m=m.split("[(=>)]");i.after(m[1]);h=e("#"+m[0]);h.addClass("add");window.setTimeout(function(){h.removeClass("add")},500);h.themeblvd("widgets");h.themeblvd("options","setup");h.themeblvd("options","bind");h.themeblvd("options","media-uploader");h.themeblvd("options","editor");h.themeblvd("options","code-editor");h.themeblvd("options","column-widths");h.themeblvd("options","sortable");if(h.find(".widget-content").hasClass("element-columns")){b.columns(h)}if(h.find(".widget-content").hasClass("element-content")){b.columns(h)}if(e.isFunction(e.fn.ThemeBlvdModal)){h.find(".tb-content-block-options-link").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}if(e.isFunction(e.fn.ThemeBlvdModal)){h.find(".tb-element-background-options").ThemeBlvdModal({build:true,form:true,padding:false,size:"medium",on_load:b.content_block_options_load})}}});return false});g.on("submit","#edit_builder",function(){var j=e(this),l=j.serialize(),k=j.find("#publishing-action .ajax-loading"),i=j.find('input[name="_tb_save_builder_nonce"]').val(),h;e.ajax({type:"POST",url:ajaxurl,data:{action:"themeblvd_save_layout",security:i,data:l},beforeSend:function(){k.fadeIn("fast")},success:function(m){m=m.split("[(=>)]");e("#builder_blvd #edit_layout").prepend(m[1]);h=e("#builder_blvd #post_title").val();e("#builder_blvd #edit_layout-tab").text(themeblvd.edit_layout+": "+h);e("#builder_blvd .postbox-publish h3").text(themeblvd.publish+" "+h);e("#builder_blvd .postbox-layout-info #post_name").val(m[0]);e("body").animate({scrollTop:0},50,function(){e("#builder_blvd #edit_layout .ajax-update").fadeIn(500,function(){setTimeout(function(){e("#builder_blvd #edit_layout .ajax-update").fadeOut(500,function(){e("#builder_blvd #edit_layout .ajax-update").remove()})},1500)})});k.fadeOut("fast");b.manager()}});return false});g.on("click",".delete-element",function(){var i=e(this).attr("href"),h=e(i),j=h.closest(".sortable");tbc_confirm(e(this).attr("title"),{confirm:true},function(k){if(k){h.addClass("delete fade-out");window.setTimeout(function(){h.remove();console.log(j.html());if(!j.html().trim().length){j.addClass("empty")}},750)}});return false});g.on("click","#edit_layout .delete_layout",function(){var h=e(this).attr("href"),j=h.replace("#",""),i="posts%5B%5D="+j;b.delete_layout(i,"click","edit_page");return false})});